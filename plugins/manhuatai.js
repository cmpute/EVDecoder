ExView.Plugins({info:{name:"漫画台",version:"2.2",icon:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAIAAACQkWg2AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAMbSURBVDhPARAD7/wA/9yN35lE2YYq9Llt///kue78QaTfLKftLqfcK6bPLqrOJabNJa/gKqjaZL7juv//APfCgMKIP9GJN8uaWPz/7IfE1iWQyBeW2UrC9FjM81rM7lfR9i626hqZzjGRuZvr/wD/4rbDn22zgkfewpLt//d0v9QTj8UXot08r9tOtdRUs9FKstkoqeIVltAul8SG5P8A9//y9fni8uXF///m6v//cLnMGJLBDpbKUcPoZcbmcsvrZcXtM6zjFZHHKI23jef/AH7K2IXEzd7//+3//+n//5zU4UiszkK540Ky10ev0kyq0Emq1UW140m231qvzKfy/wBTt9kwi6pMlrO58//c//+s6vliw+RTx/BPxvBVyPRbxPRaw/NUx/NTweZ60e+y/f8AXrffMo+6KI6/VLbjsv//Q5q1Io+4HprNFZjOE5bOG5bRF5DHGprJGpfDI429Zsf6AMD//2a54RqNxiKb0oPr/zOavSWezVrf/wuX0jC8+Wfr/w6QzDjA8lfb/xiNw0q38gDi//+49P8hkcMWlcxu2/8vnMMSlMgptfAOmtcWoN4wtPQQldAep90rsuIdk8VIuOgA7f//wvr/JJTEGJbQcNX/ULbcL6/gIKzhK7LpJ6zkJafhJarjJbDpJaveNKnUXcnvAN///7Py/xqOvxuUzZjs/2293kS02jaz3zSt2jew3zSz5jG47zO/+je68FXB5Zv9/wDc//+L0uYajsEtotiy/P92vdk6pcc2rdU+sd0+tOI6vesbo9UNlc8alMUtiKOg7PoA0P//aLXTGYi9QrLkwv//mub+RrLWJqHNN6/hX9v/WuL/HafWGJfKLJS7j87d3v//ALb9/0uewCWJunve/6/5/z6KoiOPtkXC8iml2xKRxgyUxg6VxSim1oXr/8r//9b//wCH4fwxiKY6jLK0///A//9BjKMumcNCvvItquAZmM0Yl8wZmM0in9Uzo9M/lLl3wOAAfN75VrDLb7jZw///0v//kt30Q67YL63gMq/lTcz/Xtn/P7z0OLXvPbLnTq7ee9L9WBPyXTTnqqoAAAAASUVORK5CYII=",
author:"Gentle",db:"manhuatai",apihost:"http://m.manhuatai.com/",pagetitle:["<br>","收藏","首页","类型","下载"],download:!0,lazyload:!0,setting:!0,cdn:""},set:function(a){},unset:function(a){},init:function(){ExView.workers.fav.listloader({callback:function(){ExView.workers.index.loader()}})},flags:{indexflag:{loader:function(a){a.front||a.page||addtypelist('<div align="center" class="list-block"><img src="img/logo.png"/><br>类型<br>正在加载...<div class="progress"></span></div>',
2);return{url:pluginfo(a.plugin).apihost,method:"GET",timeout:120,successfn:function(b,c){ExView.workers.index.countfinder(obj_contact(a,{result:b,header:c}));a.front||a.page||ExView.workers.type.finder({result:b,plugin:a.plugin});a.successfn&&a.successfn({result:b,header:c})},errorfn:function(){a.page||addtypelist('<div align="center" class="list-block"><a href="javascript:void(0);" onclick="ExView.workers.type.loader();"><img src="img/logo.png"/><br>加载失败，请刷新重试！</a></div>',
2);ExView.fw.hidePreloader();mySession.isloading=0;ExView.fw.alert("网络错误！","ExView")},canclefn:function(){a.page||addtypelist('<div align="center" class="list-block"><a href="javascript:void(0);" onclick="ExView.workers.type.loader();"><img src="img/logo.png"/><br>加载失败，请刷新重试！</a></div>',2)},showinfo:{text:"正在加载..."+(1<a.page?"<br>第"+a.page+"页":""),name:"首页",title:a.title,img:a.img}}},
finder:function(a){return{reg:/<li><a\s*title=""\s*href="\/(\w[-\w.+]*)\/"><div><span\s*class="a">(.*?)<\/span><span\s*class="fl"><\/span><\/div><img.*?data-url="(.*?)"\s*title="(.*?)"><span\s*class="title">(.*?)<\/span>.*?<\/a><\/li>/g,str:a.result,find:{pid:"$1",img:"$3",title:"$5",content:"$2"},successfn:function(a){console.log(JSON.stringify(a));array_count(a)?addcardlist({pid:a.pid,title:a.title,img:a.img,content:a.content,comment:1}):addcardlist('<div align="center" class="list-block"><img src="img/logo.png"/><br>没有内容</div>',
2)}}},countloader:function(a){return!1},countfinder:function(a){return{successfn:function(){mySession.nowlistpages="-1|首页|index";mySession.nowlistpage=1;console.log(mySession.nowlistpages);return!0}}}},typeflag:{loader:function(a){return{successfn:function(){ExView.workers.index.loader()}}},finder:function(a){addtypelist({title:"首页",img:pluginfo(a.plugin).icon,group:{name:"daohang",title:"导航"},content:"首页"});addtypelist({tid:"all",title:"全部",img:pluginfo(a.plugin).icon,
group:{name:"daohang",title:"导航"},content:"全部"});return{reg:/<li\s*class="onehead"><span><a\s*href="\/(\w[-\w.+]*)\.html">(.*?)<i><\/i><\/a><\/span><\/li>/g,str:a.result,find:"$1{{separator}}$2",successfn:function(b){b=b.split("{{separator}}");array_count(b)?addtypelist({tid:b[0],title:b[1],img:pluginfo(a.plugin).icon,group:{name:"fenlei",title:"分类"},content:b[1]}):addtypelist('<div align="center" class="list-block"><a href="javascript:void(0);" onclick="ExView.workers.type.loader();"><img src="img/logo.png"/><br>加载失败，请刷新重试！</a></div>',
2)}}}},listflag:{loader:function(a){return{url:pluginfo(a.plugin).apihost+a.keyword+(1<a.page?"_p"+a.page:"")+".html",method:"GET",timeout:120,successfn:function(b,c){b?(ExView.workers.list.countfinder(obj_contact(a,{result:b,header:c})),a.successfn&&a.successfn({result:b,header:c})):(ExView.fw.hidePreloader(),mySession.isloading=0,ExView.fw.alert("【"+a.title+"】<br>获取失败！","ExView"))},showinfo:{text:"正在加载..."+(1<a.page?"<br>第"+a.page+"页":
""),title:a.title,name:"【"+a.title+"】",img:a.img}}},finder:function(a){return{reg:plugfns(a.plugin).pagerule,str:a.result,find:plugfns(a.plugin).pagefind,successfn:function(b){b?plugfns(a.plugin).pagedeal(b):addcardlist('<div align="center" class="list-block"><img src="img/logo.png"/><br>没有内容</div>',1)}}},countloader:function(a){return!1},countfinder:function(a){return{reg:/<\/a>\.\.\.\.\.<a\s*target="_self"\s*class="page"\s*href=".*?_p(\d+).html">/g,str:a.result,find:"$1",
successfn:function(b){mySession.nowlistpages=(b||"-1")+"|"+a.keyword+"|list";mySession.nowlistpage=1;console.log(mySession.nowlistpages);return!0}}}},searchflag:{loader:function(a){return 1<parseInt(a.page)?(a.multsearch&&a.multsearch(),!1):{url:pluginfo(a.plugin).apihost+"getjson.shtml?q="+encodeURIComponent(a.keyword),method:"GET",timeout:120,successfn:function(b,c){b?(a.multsearch||(ExView.workers.search.countfinder(obj_contact(a,{result:b,header:c})),setnowlistname("搜索【"+a.keyword+
"】")),a.successfn&&a.successfn({result:b,header:c})):a.multsearch?a.multsearch():(ExView.fw.hidePreloader(),mySession.isloading=0,ExView.fw.alert("【"+a.keyword+"】<br>获取搜索结果失败！","ExView"))},showinfo:{text:"正在搜索..."+(1<a.page?"<br>第"+a.page+"页":""),name:"【"+a.keyword+"】",title:"搜索"}}},finder:function(a){return{json:!0,str:a.result,successfn:function(b,c,d){console.log(b);if(array_count(b)){c=
b.cartoon_id;d=b.cartoon_name;var e=b.cartoon_status_id;b=b.latest_cartoon_topic_name;if(a.multsearch)return a.multsearch(obj_contact(a,{pid:c,img:"img/nopic.png",title:d,content:e})),!1;addcardlist({pid:c,title:d,name:"【"+e+"】"+d,img:"img/nopic.png",content:"",stitle:b,comment:1})}else a.multsearch?a.multsearch():addcardlist('<div align="center" class="list-block"><img src="img/logo.png"/><br>没有内容</div>',1)}}},countloader:function(a){return!1},countfinder:function(a){return{successfn:function(b){mySession.nowlistpages=
"-1|"+a.keyword+"|search";mySession.nowlistpage=1;console.log(mySession.nowlistpages)}}}},contentflag:{loader:function(a){return{url:pluginfo(a.plugin).apihost+a.pid+"/",method:"GET",timeout:120,successfn:function(b,c){b?a.successfn&&a.successfn({result:b,header:c}):a.checkupdate||(ExView.fw.hidePreloader(),mySession.isloading=0,ExView.fw.alert("内容页获取失败！","ExView"))},showinfo:{text:"正在加载内容页...",title:"内容页",name:getlistname(a.pid),
img:getlistimg(a.pid)}}},finder:function(a){var b=[],c=0;getstrs(a.result,/displayTab\('([\w,\d]+)','topicTab','topiccount','current'\);"><span>((?!<).*?)<\/span>/g,"$1|$2").forEach(function(e){var f=e.split("|");getstrs(a.result,new RegExp('<ul id="'+f[0]+'"(.*?)</ul>',"g"),"$1").forEach(function(a){a=getstrs(a,/<li><a\s*title="(.*?)"\s*href="([A-Za-z0-9][-A-Za-z0-9]*)\.html"><span>(.*?)<\/span><\/a><\/li>/g,"$1{{separator}}$2{{separator}}$3");b.push({group:{name:f[0],title:f[1]},items:a});c+=a.length})});
if(!c){var d=getstrs(a.result,/<li><a\s*title="(.*?)"\s*href="([A-Za-z0-9][-A-Za-z0-9]*)\.html"><span>(.*?)<\/span><\/a><\/li>/g,"$1{{separator}}$2{{separator}}$3");b.push({group:{},items:d});c+=d.length}return{successfn:function(e,f,d,g){console.log(typeof e);if(a.result){if(a.checkupdate){e=b[0];var k=e.group.title||"";e=(e||{}).items;e=(e||[])[0];e=(e||"").split("{{separator}}");return{pid:a.pid,cid:e[1],title:k+" "+e[2]}}myContent.mhkey=ExView.modules.commentpage.duoshuoloader(a.result);f=c;d=
0;g=[];b.forEach(function(b){var c;c=(b||{}).items;(c||[]).forEach(function(c){c=(c||"").split("{{separator}}");g[d]=additemlist({id:f-d-1,newest:a.newest&&0==d,pid:a.pid,cid:c[1],group:b.group,title:c[2],count:f,reverse:1});g[d].title=(b.group.title?b.group.title+" ":"")+c[2];d++})});return g}a.checkupdate||(ExView.fw.hidePreloader(),mySession.isloading=0,ExView.fw.alert("内容页获取失败！","ExView"))},afterfn:function(){a.checkupdate||ExView.workers.content.infofinder(a)}}},
infoloader:function(a){return!1},infofinder:function(a){console.log(a);return{query:!0,selector:".mhjsbody",str:a.result,successfn:function(b,c,d,e){c=$$(b).find("img").attr("src");d=$$(b).find(".jshtml li").eq(0).text().replace("名称：","");e=$$(b).find(".cz").text();var f=$$(b).find(".jshtml li").eq(2).text().replace("作者：",""),h=$$(b).find(".jshtml li").eq(3).text().replace("类型：","");b=$$(b).find(".jshtml").text();var h=h.split(" "),h=h.map(function(a){return gettag(a)}),
g=f.split(" "),g=g.map(function(a){return gettag(a)});setlistpic({name:d,img:c,added:a.data,description:"<p>【作者】"+f+"<br>【状态】"+e+"<br>【简介】"+b+"</p>",comment:1,preview:0,tags:gettag(d)+h.join("")+g.join(""),sourceurl:pluginfo(a.plugin).apihost+a.pid+"/"});return!0}}}},parseflag:{loader:function(a){return{url:pluginfo(a.plugin).apihost+a.pid+"/"+a.cid+".html",method:"GET",timeout:120,successfn:function(b,c){a.successfn&&a.successfn({result:b,
header:c})},showinfo:{text:"正在加载图片信息...",title:"图片",name:getlistname(a.pid),img:getlistimg(a.pid)}}},finder:function(a){console.log(a);return{reg:/mh_info=(.*?);var\s*cnzz_comic/g,find:"$1",str:a.result,successfn:function(b){if(b){b=eval("("+b+")");b.pageid+="";for(var c=b.pageid.substr(b.pageid.length-1,1),d=[],c=function(a,b){for(var c="",d=0;d<a.length;d++)code=a.substr(d,1).charCodeAt(),newchar=String.fromCharCode(code-b),c+=newchar;return c}(b.imgpath,
c),e=parseInt(b.totalimg),f=0;f<e;f++)d.push("http://mhpic."+b.domain+"/comic/"+c+(f+1)+".jpg"+(b.comic_size||""));console.log(d);a.download?chapterpredownload({source:d,download:a.download,plugin:a.plugin}):chapterviewer({source:d,type:"image",startindex:a.startindex||0,lazyload:pluginfo(a.plugin).lazyload,zoom:!0,title:a.title})}else a.download?chapterpredownload({error:"解析错误！",download:a.download,plugin:a.plugin}):(ExView.fw.hidePreloader(),mySession.isloading=0,ExView.fw.alert("图片信息获取失败！",
"ExView"));return!0}}}},commentflag:{loader:function(a){return{url:myContent.sid?1==parseInt(a.page||1)?"http://changyan.sohu.com/api/2/topic/load?client_id=cyt0zhtFd&topic_url="+encodeURIComponent(pluginfo(a.plugin).apihost+"/"+a.pid+"/")+"&page_size=30&hot_size=0&topic_source_id="+myContent.sid:"http://changyan.sohu.com/api/2/topic/comments?client_id=cyt0zhtFd&page_size=30&topic_id="+a.sid+"&page_no="+(a.page+1):pluginfo(a.plugin).apihost+"/"+a.pid+"/",method:"GET",timeout:120,successfn:function(b,
c){var d=function(b){var d={};1==parseInt(a.page||1)&&(d=JSON.parse(b));a.callback&&a.callback({result:b,header:c,sid:d.topic_id||a.sid,commentbrowser:{url:pluginfo(a.plugin).apihost+"/"+a.pid+"/",title:"评论 - "+pluginfo(a.plugin).name+'<br><span style="font-size:16px">'+(myContent.name||"")+"</span>",browser:!1,flag:""}})};if(b)if(myContent.sid)d(b);else{myContent.sid=getstr(/id="SOHUCS"\s*sid="([\w,\d,\_]+)">/g,b);if(!myContent.sid)return a.callback(),!0;ExView.modules.curl({url:"http://changyan.sohu.com/api/2/topic/load?client_id=cyt0zhtFd&topic_url="+
encodeURIComponent(pluginfo(a.plugin).apihost+"/"+a.pid+"/")+"&page_size=30&hot_size=0&topic_source_id="+myContent.sid,method:"GET",timeout:120,successfn:function(a){d(a)},showinfo:{text:"正在加载评论...",title:"评论",name:getlistname(a.pid),img:getlistimg(a.pid)}})}else a.callback&&a.callback()}}},finder:function(a){console.log(a);return{json:!0,str:a.result,successfn:function(b,c,d,e){if(array_count(b)){c=b.comments;b=b.total_page_no;for(var f in c)a.callback&&a.callback({page:a.page||
1,pagecount:b,comment:{text:c[f].content,name:c[f].passport.nickname,avatar:c[f].passport.img_url,type:"received",label:(new Date(parseInt(c[f].create_time))).toLocaleString().replace(/:\d{1,2}$/," "),day:"",time:"",reverse:1,extra:""}})}}}},send:!1},previewflag:{loader:!1,finder:!1,more:!1},pageimgflag:{parser:!1},updateflag:{loader:function(a){return 1<a.page?(a.multupdate(),!1):{url:pluginfo(a.plugin).apihost,method:"GET",timeout:120,successfn:function(b,c){a.successfn&&a.successfn({result:b,header:c})}}},
finder:function(a){return{reg:/<li><a\s*title=""\s*href="\/(\w[-\w.+]*)\/"><div><span\s*class="a">(.*?)<\/span><span\s*class="fl"><\/span><\/div><img.*?data-url="(.*?)"\s*title="(.*?)"><span\s*class="title">(.*?)<\/span>.*?<\/a><\/li>/g,str:a.result,find:{pid:"$1",img:"$3",title:"$5",content:"$2"},successfn:function(b){console.log(JSON.stringify(b));if(array_count(b)&&a.multupdate)return a.multupdate(obj_contact(a,{pid:b.pid,img:b.img,title:b.title,content:b.content})),!1}}}},hotflag:{loader:function(a){return{url:pluginfo(a.plugin).apihost+
"all"+(1<a.page?"_p"+a.page:"")+".html",method:"GET",timeout:120,successfn:function(b,c){a.successfn&&a.successfn({result:b,header:c})}}},finder:function(a){return{reg:plugfns(a.plugin).pagerule,str:a.result,find:plugfns(a.plugin).pagefind,successfn:function(b){console.log(JSON.stringify(b));b&&plugfns(a.plugin).pagedeal(b,a)}}}}},fns:{pagerule:/<a\s*class="sdiv"\s*href="\/(\w[-\w.+]*)\/".*?><div\s*class="wrapleft"><div><span\s*class="a">(.*?)<\/span><span\s*class="fl"><\/span><\/div><img.*?data-url="(.*?)".*?><\/div><div\s*class="wrapright"><ul><li\s*class="title">(.*?)<\/li><li\s*class="type"><span>类型<\/span>(.*?)<\/li><li\s*class="status"><span>状态<\/span>(.*?)<\/li><li><span>剧情<\/span>(.*?)<\/li><\/ul><\/div>\s*<\/a>/g,
pagefind:"$1{{separator}}$2{{separator}}$3{{separator}}$4{{separator}}$5{{separator}}$6{{separator}}$7",pagedeal:function(a,b){b=b||{};a=a.split("{{separator}}");var c=a[0],d=a[2],e=a[5],f=a[3],h=a[4],g=a[1],k=a[1];if(b.multhot)return b.multhot(obj_contact(b,{pid:c,img:d,title:f,content:g})),!1;addcardlist({pid:c,title:f,name:"【"+h+"】"+f+"【"+e+"】",img:d,content:a[6].trim(),stitle:k,comment:1,preview:0,extrabutton:""})}}});
