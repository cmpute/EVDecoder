ExView.Plugins({info:{name:"腾讯漫画",version:"2.2",icon:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAC2klEQVQ4jXWSzWtcZRjFf+/XnXtnMplpRtNMmphq0qaxiBEbC0HrB7Q0EcGVWOxGWxBXBtSNdOWiC4sQxIX6D8RVpV0YA4pgaRVBbRepCGFaU5sv08kkk8xk5t73fV1Imw7Uszyc5zwf5xFXhwzCaFQgkEaiUwoVSh6bLnMXiye6KE4tAVA91Tl6dump8c/tc69Udo8Mau7D0JUqAKWxjvtphOPU2ls9LwVpdVirTP+HAz8xnPuV00ufLesnrzcBmB3J7FQk/sX5ox2vhmk9EuXMwUJvpt1EmtpGk8qjZTqeqZJtGI78df4b4b3/z2A4/a4W8nioxBNhoLrDXYEIHgowhQDnFOvNGvGhO3Q/3eDqcsD32S5MmHpHXH5cTa5X5Nv7QxlGkUZHEpNW6JxBtwXUnWCja5P8eJX8I57l2zDlOrGB2Xrv+fk2OTqbTFwJ3eTMtqtsNi2B9QgLdsuzUt5mbWiV4skN8nuhcQcuVrNk8pp0m/wF4N4KAG8UzcwhpY+OFYxQnZ7oZJ09ow6cQNQ8384bbvUW2J0TrNTNJ4rgfTF3TNE/k7RcfWIgWP14KikEBXAxSA9/Lgi+c7sY2G9oOOtW6oUXlAguSe/hy+GWNDlQiP82XWABaWBtzXNZRAzsE2SjBOfl/OmhPy69eeAaMm0sI522xeB4kYyzHmE8rumZ/sfwcFGRixKUiElc6re7Wh0dLrJPwvpH3XjAJ578sz2/V3+sNCltxl8tiN7N13THsR5P4izNBjgZTd97ssUvhlu64z20t+OX5yhOLADw8plw+9wZlXKJoFxV1SPF9XaAizcH0cK2jo/z4CxS76RTuy6/nrvhXu/vk9Rjc+3CjUEphXMCkDwAQgA79fxwvnZi+gLlRuKxLvWzkbHTwqKF/R8DIPGt3FZFf3pr0fvxvbc/GO8rMdZXIhZp9IMMpPOsRorJc1lirxBA3x59tjQbHWRwRxcpz7/eIxgXbK5ouwAAAABJRU5ErkJggg==",
author:"CCAV",db:"tencent",apihost:"http://m.ac.qq.com/",pagetitle:["<br>","收藏","今日更新","类型","下载"],lazyload:!0,download:!0,setting:!0,webpage:{url:"http://m.ac.qq.com/home/index?iframe_hijack_redirected=1",title:"登陆",browser:!0,flag:"",callbackname:"webpagefork"},commentbar:!1,cdn:""},set:function(a){},unset:function(a){},init:function(a){ExView.workers.fav.listloader({callback:function(){ExView.workers.type.loader();ExView.workers.index.loader()}})},
flags:{indexflag:{loader:function(a){a.front||a.page||setnowlistname("今日更新","",pluginfo(a.plugin).icon);return{url:pluginfo(a.plugin).apihost+"index/more?type="+(a.flag||"update")+"&page="+(a.page||1)+"&pageSize=20&style=items",method:"GET",timeout:120,cookie:"hasContinued=1",successfn:function(b,c){ExView.workers.index.countfinder(obj_contact(a,{result:b,header:c}));a.successfn&&a.successfn({result:b,header:c})},showinfo:{text:"正在加载..."+(1<a.page?"<br>第"+
a.page+"页":""),title:a.title,name:"今日更新",img:a.img}}},finder:function(a){return{reg:plugfns(a.plugin).pagerule,str:a.result,find:plugfns(a.plugin).pagefind,successfn:function(b){console.log(JSON.stringify(b));b?plugfns(a.plugin).pagedeal(b,a):(mySession.nowpluginfo.listallmode||mySession.gobalsettings.forcelistallmode)&&(!mySession.nowpluginfo.listallmode&&!mySession.gobalsettings.forcelistallmode||$$("#card-page>.cardremovedsave").length||$$(".carditem").length)||addcardlist('<div align="center" class="list-block"><img src="img/logo.png"/><br>没有内容</div>',
2)},errorfn:function(){a.page||setnowlistname("今日更新","",pluginfo(a.plugin).icon);ExView.fw.hidePreloader();mySession.isloading=0;ExView.fw.alert("网络错误！","ExView")}}},countloader:function(a){return!1},countfinder:function(a){return{successfn:function(){return{pagecount:0}}}}},typeflag:{loader:function(a){return{url:pluginfo(a.plugin).apihost+"category/index",method:"GET",timeout:120,cookie:"hasContinued=1",successfn:function(b,c){a.successfn&&a.successfn({result:b,
header:c})}}},finder:function(a){addtypelist({listflag:"update",title:"今日更新",img:pluginfo(a.plugin).icon,group:{name:"daohang",title:"导航"},content:"今日更新"});addtypelist({listflag:"new",title:"新作上线",img:pluginfo(a.plugin).icon,group:{name:"daohang",title:"导航"},content:"新作上线"});addtypelist({listflag:"jump",title:"日漫经典",img:pluginfo(a.plugin).icon,group:{name:"daohang",title:"导航"},
content:"日漫经典"});addtypelist({listflag:"suggest",title:"无良推荐",img:pluginfo(a.plugin).icon,group:{name:"daohang",title:"导航"},content:"无良推荐"});addtypelist({tid:"light",title:"轻小说",img:pluginfo(a.plugin).icon,group:{name:"daohang",title:"导航"},content:"轻小说"});ExView.modules.rulefind({reg:/item-link"\s*href="\/category\/listAll\?type=(\w+)&rank=\w+">\s*\n*\s*<strong>(.*?)<\/strong>/g,str:a.result,
find:"$1{{separator}}$2",successfn:function(b){b=b.split("{{separator}}");if(array_count(b)){var c=b[1];addtypelist({tid:b[0],title:c,img:pluginfo(a.plugin).icon,group:{name:"tuijian",title:"推荐"},content:c})}},afterfn:function(){}});return{reg:/item-link"\s*href="\/category\/listAll\?type=([A-Za-z0-9]+)&rank=pgv">(\s|[\r\n])*?<span\s*class="item-name">.*?\s(.*?)<\/span>(\s|[\r\n])*?<img\s*class="item-cover"\s*src="(.*?)">/g,str:a.result,find:"$1{{separator}}$3{{separator}}$5",successfn:function(a){a=
a.split("{{separator}}");if(array_count(a)){var c=a[1];addtypelist({tid:a[0],title:c,img:a[2],listbg:!0,group:{name:"fenlei",title:"分类"},content:c})}}}}},listflag:{loader:function(a){var b={url:"light"==a.keyword?"http://ac.qq.com/Comic/all/type/8/search/hot/page/"+(a.page||1):pluginfo(a.plugin).apihost+"category/listAll/type/"+a.keyword+"/rank/pgv?page="+(a.page||1)+"&pageSize=20&style=items",method:"GET",timeout:120,cookie:"hasContinued=1",successfn:function(b,d){b?(ExView.workers.list.countfinder(obj_contact(a,
{result:b,header:d})),a.successfn&&a.successfn({result:b,header:d})):(ExView.fw.hidePreloader(),mySession.isloading=0,ExView.fw.alert("【"+a.title+"】<br>获取失败！","ExView"))},showinfo:{text:"正在加载..."+(1<a.page?"<br>第"+a.page+"页":""),title:"类型",name:"【"+a.title+"】",img:a.img}};"light"==a.keyword&&(b.nativerequest="undefined"==typeof cordova?!1:!0,b.header={"User-Agent":"ExView"});return b},finder:function(a){return"light"==
a.keyword?{reg:/class="ret-search-item(.*?)<\/li>/g,str:getresult(a.result),find:"$1",successfn:function(a){if(a){var c=getstr(/Comic\/comicInfo\/id\/(\d+)"/,a),d=getstr(/title="((?!\").*?)"/,a),e=getstr(/data-original="((?!\").*?)"/,a),f=getstr(/class="ret-works-decs">((?!\<).*?)</,a);a=getstr(/class="mod-cover-list-text">((?!\<).*?)</,a);addcardlist({pid:c,title:d,name:"【轻小说】"+d,img:e,content:f,stitle:a,comment:1,preview:0,extrabutton:""})}else addcardlist('<div align="center" class="list-block"><img src="img/logo.png"/><br>没有内容</div>',
1)}}:{reg:plugfns(a.plugin).pagerule,str:a.result,find:plugfns(a.plugin).pagefind,successfn:function(b){b?plugfns(a.plugin).pagedeal(b):addcardlist('<div align="center" class="list-block"><img src="img/logo.png"/><br>没有内容</div>',1)}}},countloader:function(a){return!1},countfinder:function(a){return{successfn:function(){return{pagecount:0,keyword:a.keyword}}}}},searchflag:{loader:function(a){return{url:pluginfo(a.plugin).apihost+"search/result?word="+encodeURIComponent(a.keyword)+
"&page="+(a.page||1)+"&pageSize=20&style=items",method:"GET",timeout:120,successfn:function(b,c){b?(a.multsearch||(ExView.workers.search.countfinder(obj_contact(a,{result:b,header:c})),setnowlistname("搜索【"+a.keyword+"】")),a.successfn&&a.successfn({result:b,header:c})):a.multsearch?a.multsearch():(ExView.fw.hidePreloader(),mySession.isloading=0,ExView.fw.alert("【"+a.keyword+"】<br>获取搜索结果失败！","ExView"))},showinfo:{text:"正在搜索..."+
(1<a.page?"<br>第"+a.page+"页":""),name:"【"+a.keyword+"】",title:"搜索"}}},finder:function(a){return{reg:plugfns(a.plugin).pagerule,str:a.result,find:plugfns(a.plugin).pagefind,successfn:function(b,c,d){console.log(b);b?plugfns(a.plugin).pagedeal(b,a):a.multsearch?a.multsearch():addcardlist('<div align="center" class="list-block"><img src="img/logo.png"/><br>没有内容</div>',1)}}},countloader:function(a){return!1},countfinder:function(a){return{successfn:function(b){return{pagecount:0,
keyword:a.keyword}}}}},contentflag:{loader:function(a){return{url:pluginfo(a.plugin).apihost+"comic/chapterList/id/"+a.pid,method:"GET",timeout:120,cookie:"hasContinued=1",successfn:function(b,c){b?a.successfn&&a.successfn({result:b,header:c}):a.checkupdate||(ExView.fw.hidePreloader(),mySession.isloading=0,ExView.fw.alert("内容页获取失败！","ExView"))},showinfo:{text:"正在加载内容页...",title:"内容页",name:getlistname(a.pid),
img:getlistimg(a.pid)}}},finder:function(a){return{reg:/<li\s*class="chapter-item">(?:.|[\r\n])*?href="\/chapter\/index\/id\/(\d+)\/cid\/(\d+)">(\d+)<\/a>/g,str:getstr(/<ul\s*class="chapter-list\s*normal">((?:.|[\r\n])*?)<\/ul>/,a.result),find:{pid:"$1",cid:"$2",title:"第$3话"},successfn:function(b,c,d,e){console.log(typeof b);if(array_count(b)){if(a.checkupdate)return{pid:b.pid,cid:b.cid,title:b.title};additemlist({id:c.length-d-1,newest:a.newest&&0==d,pid:b.pid,cid:b.cid,title:b.title,count:c.length,
reverse:1})}else a.checkupdate||(ExView.fw.hidePreloader(),mySession.isloading=0,ExView.fw.alert("内容页获取失败！","ExView"))},afterfn:function(){a.checkupdate||ExView.workers.content.infoloader(a)}}},infoloader:function(a){return{url:pluginfo(a.plugin).apihost+"comic/index/id/"+a.pid,method:"GET",timeout:120,cookie:"hasContinued=1",successfn:function(b,c){b?a.successfn&&a.successfn({result:b,header:c}):(ExView.fw.hidePreloader(),mySession.isloading=0,ExView.fw.alert("内容页获取失败！",
"ExView"))},showinfo:{text:"正在加载简介信息...",title:"内容页",name:getlistname(a.pid),img:getlistimg(a.pid)}}},infofinder:function(a){console.log(a);return{reg:/<div\s*class="head-info-cover">(?:.|[\r\n])*?<img\s*src="(.*?)"(?:.|[\r\n])*?<div\s*class="head-info-detail">(?:.|[\r\n])*?<li\s*class="head-info-title">(?:.|[\r\n])*?<h1>(.*?)<\/h1>(?:.|[\r\n])*?<span\s*class="head-info-grade">(.*?)<\/span>(?:.|[\r\n])*?<li\s*class="head-info-tags">((?:.|[\r\n])*?)<\/li>(?:.|[\r\n])*?<li\s*class="head-info-author">(\s|[\r\n])*?作者：(.*?)\s*<\/li>/g,
str:a.result,find:"$1{{separator}}$2{{separator}}$3{{separator}}$4{{separator}}$6",successfn:function(b,c,d,e){if(b){b=b.split("{{separator}}");console.log(JSON.stringify(b));c=b[0];d=b[1];e=b[2];var f=b[3].replace(/<label>标签：<\/label>/g,"").replace(/\r\n/g,"").replace(/\r/g,"").replace(/\n/g,"").replace(/\s/g,"").replace(/<span>/g,"").trim().split("</span>");b=b[4];var h=getstr(/<div\s*class="detail-summary">(?:.|[\r\n])*?<p>(.*?)<\/p>(?:.|[\r\n])*?<\/div>/g,a.result),g="",k;for(k in f)""!=
f[k].trim()&&(g+=gettag(f[k]))}else e="",d=getstr(/class="title-content">((?!\").*?)</,a.result),b=getstr(/作者：\s*<span\s*class="text">((?!\").*?)<\/span>/,getresult(a.result)),c=getstr(/<img\s*class="cover(?!\").*?src=((?!\").*?)"/,getresult(a.result)),h=gettext(getstr(/<span>作品介绍：\s*<\/span>((?!\").*?)<\/div>/,getresult(a.result))),g="";setlistpic({name:d,img:c,added:a.data,description:"<p>"+(b?"【作者】"+b+"<br>":"")+(e?"【评分】"+
e+"<br>":"")+(h?"【简介】"+h:"")+"</p>",comment:1,preview:0,tags:gettag(d)+g+gettag(b),sourceurl:pluginfo(a.plugin).apihost+"comic/index/id/"+a.pid});return!0},errorfn:function(){}}}},parseflag:{loader:function(a){return{url:pluginfo(a.plugin).apihost+"chapter/index/id/"+a.pid+"/cid/"+a.cid,method:"GET",timeout:120,cookie:"hasContinued=1",successfn:function(b,c){a.successfn&&a.successfn({result:b,header:c})},showinfo:{text:"正在加载图片信息...",title:"图片",
name:getlistname(a.pid),img:getlistimg(a.pid)}}},finder:function(a){console.log(a);return{reg:/data:\s*'(.*?)'/g,str:a.result,find:"$1",successfn:function(b){b||(b=getstr(/initPage\(id, cid, \'(.*?)\'/g,a.result));b=JSON.parse(ExView.tools.base64.decode(b.substring(1)));b=b.picture;if(array_count(b)){1==array_count(b)&&ExView.fw.alert("此为VIP章节，洗洗睡吧！");var c=[],d;for(d in b)c.push(b[d].url);console.log(c);a.download?chapterpredownload({source:c,download:a.download,
plugin:a.plugin}):chapterviewer({source:c,type:"image",startindex:a.startindex||0,lazyload:pluginfo(a.plugin).lazyload,zoom:!0,title:a.title})}else a.download?chapterpredownload({error:"解析错误！",download:a.download,plugin:a.plugin}):(ExView.fw.hidePreloader(),mySession.isloading=0,ExView.fw.alert("图片信息获取失败！","ExView"));return!0}}}},commentflag:{loader:function(a){return{url:pluginfo(a.plugin).apihost+"comment/getCommentList/id/"+
a.pid+"?page="+(a.page||1)+"&pageSize=20",method:"GET",timeout:120,cookie:"hasContinued=1",successfn:function(b,c){b?a.successfn&&a.successfn({result:b,header:c,commentbrowser:{url:pluginfo(a.plugin).apihost+"comment/index/id/"+a.pid+"?iframe_hijack_redirected=1",title:"评论 - "+(myContent.name||""),browser:!0,flag:"",callbackname:"webpagefork"}}):(ExView.fw.hidePreloader(),mySession.isloading=0,ExView.fw.alert("评论获取失败！","ExView"))},showinfo:{text:"正在获取评论信息...",
title:"评论页",name:getlistname(a.pid),img:getlistimg(a.pid)}}},finder:function(a){console.log(a);return{json:!0,str:a.result,successfn:function(b,c,d,e){c=(b||{}).data.commentList;var f=(b||{}).data.totalNum;array_count(c)?c.forEach(function(b){addcommentlist({page:a.page||1,pagecount:Math.ceil(f/20),comment:{text:b.content,name:b.nick_name,avatar:b.qq_head,type:"received",label:(new Date(1E3*parseInt(b.pub_time))).toLocaleString().replace(/:\d{1,2}$/," "),day:"",time:"",reverse:1}})}):
(ExView.fw.hidePreloader(),mySession.isloading=0,ExView.modules.commentpage.error(a),ExView.fw.alert("评论获取失败！","ExView"))}}},send:!1},previewflag:{loader:!1,finder:!1,more:!1},pageimgflag:{parser:!1},updateflag:{loader:function(a){return{url:pluginfo(a.plugin).apihost+"index/more?type=update&page="+(a.page||1)+"&pageSize=20&style=items",method:"GET",timeout:120,cookie:"hasContinued=1",successfn:function(b,c){a.successfn&&a.successfn({result:b,header:c})}}},finder:function(a){return{reg:plugfns(a.plugin).pagerule,
str:a.result,find:plugfns(a.plugin).pagefind,successfn:function(b){console.log(JSON.stringify(b));b&&plugfns(a.plugin).pagedeal(b,a)}}}},hotflag:{loader:function(a){return{url:pluginfo(a.plugin).apihost+"index/more?type=suggest&page="+(a.page||1)+"&pageSize=20&style=items",method:"GET",timeout:120,cookie:"hasContinued=1",successfn:function(b,c){a.successfn&&a.successfn({result:b,header:c})}}},finder:function(a){return{reg:plugfns(a.plugin).pagerule,str:a.result,find:plugfns(a.plugin).pagefind,successfn:function(b){console.log(JSON.stringify(b));
b&&plugfns(a.plugin).pagedeal(b,a)}}}}},fns:{webpagefork:function(a){if("string"==typeof a.container){var b=a.container;clearInterval(mySession.webpageforkloadser);mySession.webpageforkloadser=setInterval(function(){var a=$$(b)[0];if(a){var d=a.contentWindow.location.href;if(0==d.indexOf("http://m.ac.qq.com/")){if("http://m.ac.qq.com/"==d||0==d.indexOf("http://m.ac.qq.com/home/index")&&-1==d.indexOf("iframe_hijack_redirected=1"))a.contentWindow.location.href=d+(-1==d.indexOf("?")?"?":"&")+"iframe_hijack_redirected=1";
$$("a",a.contentWindow.document).each(function(){var a=$$(this).attr("href");a&&-1==a.indexOf("iframe_hijack_redirected=1")&&-1==a.indexOf("#")&&0!=a.indexOf("javascript")&&$$(this).attr("href",a+(-1==a.indexOf("?")?"?":"&")+"iframe_hijack_redirected=1")})}}else clearInterval(mySession.webpageforkloadser)},100)}else a=a.container,a.addEventListener("loadstart",function(){}),a.addEventListener("loadstop",function(){}),a.addEventListener("loaderror",function(){}),a.addEventListener("exit",function(){})},
pagerule:/<li\s*class="comic-item">((?:.|[\r\n])*?)<\/li>/g,pagefind:"$1",pagedeal:function(a,b){b=b||{};a=a.split("{{separator}}");var c=getstr(/class="comic-link"\s*href="\/comic\/index\/id\/(\d+)"/,a[0]),d=getstr(/class="cover-image"\s*src="((?!\").*?)"/,a[0]),e=getstr(/class="comic-title">((?:.|[\r\n])*?)</,a[0]),f=getstr(/class="comic-update">((?!\").*?)</,a[0])||"",h=getstr(/class="comic-tag">((?!\").*?)</,a[0])||"",g=getstr(/class="comic-desc">((?:.|[\r\n])*?)</,a[0])||"",e=e.trim().replace(/\n/,
"");if(b.multupdate)return b.multupdate(obj_contact(b,{pid:c,img:d,title:e,content:f})),!1;if(b.multhot)return b.multhot(obj_contact(b,{pid:c,img:d,title:e,content:f})),!1;if(b.multsearch)return b.multsearch(obj_contact(b,{pid:c,img:d,title:e,content:f})),!1;addcardlist({pid:c,title:e,name:"【"+h+"】"+e,img:d,content:g,stitle:f,comment:1,preview:0,extrabutton:""})}}});
