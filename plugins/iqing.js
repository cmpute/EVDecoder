ExView.Plugins({info:{name:"空之文库",version:"2.2",icon:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAACGVBMVEW41/+61/+52P5Osv/S5/641v396t7+iqW21v+y1P6JyP5du/7ZtLfipbDtnKv9iaT+g57A3P5uvv5huf5XuP7H4f3C3fvK3/qKx/m61Ova3+fmy9f9yc7otrn4maz+lKzooqvpmKf+jaf0kKX3hqDwf5e3koTjbITVVGLgQUu62f+r0f+hzf+Tyf9dt/9Lsf9GsP/N5f6r0f5Dsv47sP4ur/7c6/1Asf2q0vyi1fuDxfp3w/nT4vey1vfX5PSwjvSy1PLh5fGMwPDPxu++1e7B0euvzemewuXc0uLU2d7a1djc09Xx39TdxdTJxtPby9LQyNKYdtLa0NHNvdHr2M7d08u4xsmjv8n+1sbHp8by0cX9vMTCwMHk0rrby7nJvLnwtLnRtrb2p7TjwLL+n7HUq63eyarHs6jul6f+jKfinKb6jabdl6XulKTkraPXrKL0naLjkqH4h6H5hp3TlJvIsJq6mJnkk5nqgpj+f5eyj5bqi5bih5Xq0pTBnpLVm5LajZLbf5LMkpD9conkv4fwbYbmmoLGZYLTrH/Ji3/QbH/dvH6egn7fY363jX2egXz8gHy/dny/c3zZZHzkx3uGdHqia3T6YXPWYnHkjW7lS23pxWy7Ymv6c2qJZGjWtGagcWPMR2Hsyl+vVF29l1a0gE+hcUfYtEbTeUP6RkLSnj94Pj6yXDj6PTW1dDLSpSvXpyrnHh3oFREqIg1XAAABFUlEQVQY0w3I02IDURQAwHOXcTZu3Dipbdu2bdu2bdv6wmYeB8ALx73dASHEypTgngjAw4frzwEMI1M+E8NJDABxE1SyIILwVZde7sQqAIAdNtRr4PP56aFxPa9qZ4jSBEKLkLaYeFE1ERiIWSqtZryuvEE3oaklSBbgHF7rqL1dbxzZZ3R5mASCYwzM8QVNm/vWFum2yADgKlvm7YcDwzNHVydMpzIQkHzOsRudT1HxufeOxhA2+ClWf7uLCymqqKLrb1pGgpgn3Fu6yZgqKDmtt/VnSyFJYL79enp4u15f+bAZXV0gWWs6+zkfq2y23r1s6p3ByelY/m56r97eOHicFWRJAWEi4nnSWrU1uFCWKndj/wNh7kJEhMSz6AAAAABJRU5ErkJggg==",
author:"Gentle",type:"text",db:"iqing",apihost:"http://www.iqing.in/",pagetitle:["<br>","收藏","最新","类型","下载"],theme:"cyan",lazyload:!0,download:!0,setting:!0,typelistmode:!0,smallpicmode:!0,requestcookie:"",cdn:""},set:function(a){},unset:function(a){},init:function(){ExView.workers.fav.listloader({callback:function(){ExView.workers.index.loader();ExView.workers.type.loader()}})},flags:{indexflag:{loader:function(a){return{url:pluginfo(a.plugin).apihost+"book/last/?limit=20&offset="+
20*(parseInt(a.page||1)-1),method:"GET",timeout:120,successfn:function(b,c){ExView.workers.index.countfinder(obj_contact(a,{result:b,header:c}));a.successfn&&a.successfn({result:b,header:c})},showinfo:{text:"正在加载..."+(1<a.page?"<br>第"+a.page+"页":""),name:"最新",title:a.title,img:a.img}}},finder:function(a){return{json:!0,str:a.result,successfn:function(b){b=(b||{}).results;array_count(b)?plugfns(a.plugin).pagedeal(b):addcardlist('<div align="center" class="list-block"><img src="img/logo.png"/><br>没有内容</div>',
1)}}},countloader:function(a){return!1},countfinder:function(a){return{successfn:function(){var b=0;try{b=JSON.parse(a.result),b=Math.ceil(b.count/20)}catch(c){}return{pagecount:b}}}}},typeflag:{loader:function(a){return{url:pluginfo(a.plugin).apihost+"list/0-1/",method:"GET",timeout:120,successfn:function(b,c){a.successfn&&a.successfn({result:b,header:c})}}},finder:function(a){addtypelist({title:"最新",img:pluginfo(a.plugin).icon,group:{name:"daohang",title:"导航"},content:"最新"});
addtypelist({tid:"book/book_rank/?",title:"最热",img:pluginfo(a.plugin).icon,group:{name:"daohang",title:"导航"},content:"最热"});addtypelist({tid:"list/0/filter/?field=updated_time&",title:"全部分区",img:pluginfo(a.plugin).icon,group:{name:"fenqu",title:"分区"},content:"全部分区"});addtypelist({tid:"list/0/filter/?channel=10&field=updated_time&",title:"少年分区",img:pluginfo(a.plugin).icon,group:{name:"fenqu",title:"分区"},
content:"少年分区"});addtypelist({tid:"list/0/filter/?channel=11&field=updated_time&",title:"少女分区",img:pluginfo(a.plugin).icon,group:{name:"fenqu",title:"分区"},content:"少女分区"});addtypelist({tid:"list/0/filter/?field=updated_time&",title:"全部分类",img:pluginfo(a.plugin).icon,group:{name:"fenlei",title:"分类"},content:"全部分类"});return{reg:/\/list\/(\d+)-1\/"\s*class="">((?!<).*?)<\/a>/g,str:a.result,
find:"$1{{separator}}$2",successfn:function(b){b=b.split("{{separator}}");array_count(b)?addtypelist({tid:"list/"+b[0]+"/filter/?field=updated_time&",title:b[1],img:pluginfo(a.plugin).icon,group:{name:"fenlei",title:"分类"},content:b[1]}):addtypelist('<div align="center" class="list-block"><a href="javascript:void(0);" onclick="ExView.workers.type.loader();"><img src="img/logo.png"/><br>加载失败，请刷新重试！</a></div>',2)}}}},listflag:{loader:function(a){return{url:pluginfo(a.plugin).apihost+
a.keyword+"limit=20&offset="+20*(parseInt(a.page||1)-1),method:"GET",timeout:120,successfn:function(b,c){b?(ExView.workers.list.countfinder(obj_contact(a,{result:b,header:c})),a.successfn&&a.successfn({result:b,header:c})):(ExView.fw.hidePreloader(),mySession.isloading=0,ExView.fw.alert("【"+a.title+"】<br>获取失败！","ExView"))},showinfo:{text:"正在加载..."+(1<a.page?"<br>第"+a.page+"页":""),name:"【"+a.title+"】",title:a.title,img:a.img}}},
finder:function(a){return{json:!0,str:a.result,successfn:function(b){b=(b||{}).results;array_count(b)?plugfns(a.plugin).pagedeal(b):addcardlist('<div align="center" class="list-block"><img src="img/logo.png"/><br>没有内容</div>',1)}}},countloader:function(a){return!1},countfinder:function(a){return{successfn:function(){var b=0;try{b=JSON.parse(a.result),b=Math.ceil(b.count/20)}catch(c){}return{pagecount:b,keyword:a.keyword}}}}},searchflag:{loader:function(a){return{url:pluginfo(a.plugin).apihost+
"book/search/?q="+a.keyword+"&limit=20&offset="+20*(parseInt(a.page||1)-1),method:"GET",timeout:120,successfn:function(b,c){b?(a.multsearch||(ExView.workers.search.countfinder(obj_contact(a,{result:b,header:c})),setnowlistname("搜索【"+a.keyword+"】")),a.successfn&&a.successfn({result:b,header:c})):a.multsearch?a.multsearch():(ExView.fw.hidePreloader(),mySession.isloading=0,ExView.fw.alert("【"+a.keyword+"】<br>获取搜索结果失败！","ExView"))},
showinfo:{text:"正在搜索..."+(1<a.page?"<br>第"+a.page+"页":""),name:"【"+a.keyword+"】",title:"搜索"}}},finder:function(a){return{json:!0,str:a.result,successfn:function(b){b=(b||{}).results;array_count(b)?plugfns(a.plugin).pagedeal(b,a):a.multsearch?a.multsearch():addcardlist('<div align="center" class="list-block"><img src="img/logo.png"/><br>没有内容</div>',1)}}},countloader:function(a){return!1},countfinder:function(a){return{successfn:function(){var b=
0;try{b=JSON.parse(a.result),b=Math.ceil(b.count/20)}catch(c){}return{pagecount:b,keyword:a.keyword}}}}},contentflag:{loader:function(a){return{url:pluginfo(a.plugin).apihost+"book/"+a.pid+"/",method:"GET",timeout:120,successfn:function(b,c){b?a.successfn&&a.successfn({result:b,header:c}):a.checkupdate||(ExView.fw.hidePreloader(),mySession.isloading=0,ExView.fw.alert("内容页获取失败！","ExView"))},showinfo:{text:"正在加载目录...",title:"内容页",
name:getlistname(a.pid),img:getlistimg(a.pid)}}},finder:function(a){var b=[];a.result=getresult(a.result);var c=getstrs(a.result,/<li\s*class="volume">(.*?)<\/ul>/g,"$1"),c=c.map(function(a){var c=getstr(/<h3>((?!>).*?)<\/h3>/,a);getstrs(a,/\/read\/(\d+)"\s*title="((?!\").*?)"/g,"$1{{separator}}$2").map(function(a){a=(a||"").split("{{separator}}");b.push({group:{name:"type_"+ExView.tools.md5.hex_md5(c),title:c},item:{cid:a[0],title:a[1]}})})});b.length||getstrs(a.result,/\/read\/(\d+)"\s*title="((?!\").*?)"/g,
"$1{{separator}}$2").map(function(a){a=(a||"").split("{{separator}}");b.push({group:{},item:{cid:a[0],title:a[1]}})});return{successfn:function(c,e,d,f){console.log(typeof c);if(array_count(c)){if(a.checkupdate)return e=b,c=e[e.length-1],d=((c||{}).group||{}).title||"",c=(c||{}).item,{pid:a.pid,cid:c.cid,title:d+" "+c.title};myContent.comment_id=getstr(/\/brand\/([\w,\d]+)\/post_list\//,a.result);e=b;f=[];b.map(function(b,c){var d=b.item;f[c]=additemlist({id:c,newest:a.newest&&0==c,pid:a.pid,cid:d.cid,
title:d.title,group:b.group,count:e.length,reverse:0});f[c].title=((b.group||{}).title||"")+" "+d.title});return f}a.checkupdate||(ExView.fw.hidePreloader(),mySession.isloading=0,ExView.fw.alert("内容页获取失败！","ExView"))},afterfn:function(){a.checkupdate||ExView.workers.content.infofinder(a)}}},infoloader:function(a){return!1},infofinder:function(a){console.log(a);return{reg:/class="content"(.*?)class="read"/g,str:getresult(a.result),find:"$1",successfn:function(b,
c,g,e){console.log(JSON.stringify(b));c=getstr(/<img(?!<).*?src="((?!\").*?)"/,b);g=getstr(/class="title">((?!<).*?)</,b);e=gettext(getstr(/作者：<\/span><(?!\").*?>((?!\").*?)</,b)).replace(/&nbsp;/g,"").trim();var d=getstrs(b,/cat-\d+">((?!<).*?)</g,"$1"),f=gettext(getstr(/datePublished"\s*content="((?!\").*?)"/,b)).trim(),l=gettext(getstr(/字数：<\/span><(?!\").*?>((?!<).*?)</,b)).trim();b=gettext(getstr(/简介：<\/span>(.*?)<\/p>/,b)).replace(/\n/g,"<br>").trim();
var h=gettag(d),d=(d||[]).join(" ").trim();setlistpic({name:g,img:c,added:a.data,description:"<p>"+(e?"【作者】"+e+"<br>":"")+(d?"【类型】"+d+"<br>":"")+(l?"【字数】"+l+"<br>":"")+(f?"【更新】"+f+"<br>":"")+(b?"【简介】"+b:"")+"</p>",sourceurl:pluginfo(a.plugin).apihost+"book/"+a.pid+"/",comment:1,preview:0,tags:gettag(g)+h+gettag(e)+gettag(status)});return!0}}}},parseflag:{loader:function(a){return a.cid?{url:pluginfo(a.plugin).apihost+
"content/"+a.cid+"/chapter/",method:"GET",timeout:120,successfn:function(b,c){a.successfn&&a.successfn({result:b,header:c})},showinfo:{text:"正在加载文章信息...",title:"文章",name:getlistname(a.pid),img:getlistimg(a.pid)}}:(a.download||(ExView.fw.alert("此作品已经被下架啦！！！"),ExView.fw.hidePreloader(),mySession.isloading=0),!1)},finder:function(a){console.log(a);return{json:!0,str:a.result,successfn:function(b){b=
(b||{}).results;array_count(b)?(b=b.map(function(a){return 1==a.type?'<img src="'+a.value.replace("https://","http://")+'">':a.value}),b=b.join("<br>"),b=getarticle(b),console.log(b),a.download?chapterpredownload({type:"text",source:b,download:a.download,plugin:a.plugin}):chapterviewer({source:b,type:"text",startindex:a.startindex||0,lazyload:pluginfo(a.plugin).lazyload,zoom:!0,title:a.title})):a.download?chapterpredownload({error:"解析错误！",download:a.download,plugin:a.plugin}):
(ExView.fw.hidePreloader(),mySession.isloading=0,ExView.fw.alert("文章信息获取失败！","ExView"));return!0}}}},commentflag:{loader:function(a){myContent.comment_id&&myContent.pid==a.pid||$$.ajax({url:pluginfo(a.plugin).apihost+"book/"+a.pid+"/",success:function(a){if(a=getstr(/\/brand\/([\w,\d]+)\/post_list\//,a))myContent.comment_id=a},error:function(){},async:!1});return{url:pluginfo(a.plugin).apihost+"brand/"+myContent.comment_id+"/post_list/?limit=20&offset="+
20*(parseInt(a.page||1)-1),method:"GET",timeout:120,successfn:function(b,c){b?a.callback&&a.callback({result:b,header:c,commentbrowser:{url:pluginfo(a.plugin).apihost+"book/"+a.pid+"/",title:"评论 - "+pluginfo(a.plugin).name+'<br><span style="font-size:16px">'+(myContent.name||"")+"</span>",browser:!0,flag:""}}):a.callback&&a.callback()}}},finder:function(a){console.log(a);return{json:!0,str:a.result,successfn:function(b,c,g,e){if(array_count(b)){c=Math.ceil(b.count/20);b=b.results;for(var d in b)a.callback&&
a.callback({page:a.page||1,pagecount:c,comment:{text:b[d].content,name:(b[d].user||{}).username,avatar:getimgload((b[d].user||{}).avatar||"img/logo.png",a.plugin),type:"received",label:getLocalTime(parseInt(b[d].updated_time)),day:"",time:"",reverse:1,extra:""}})}}}},send:!1},previewflag:{loader:!1,finder:!1,more:!1},pageimgflag:{parser:!1},updateflag:{loader:function(a){return{url:pluginfo(a.plugin).apihost+"book/last/?limit=20&offset="+20*(parseInt(a.page||1)-1),method:"GET",timeout:120,successfn:function(b,
c){a.successfn&&a.successfn({result:b,header:c})}}},finder:function(a){return{json:!0,str:a.result,successfn:function(b){b=(b||{}).results;array_count(b)?plugfns(a.plugin).pagedeal(b,a):a.multupdate()}}}},hotflag:{loader:function(a){return{url:pluginfo(a.plugin).apihost+"book/book_rank/?limit=20&offset="+20*(parseInt(a.page||1)-1),method:"GET",timeout:120,successfn:function(b,c){a.successfn&&a.successfn({result:b,header:c})}}},finder:function(a){return{json:!0,str:a.result,successfn:function(b){b=
(b||{}).results;array_count(b)?plugfns(a.plugin).pagedeal(b,a):a.multhot()}}}}},fns:{pagecountrule:/\?page=\d+">(\d+)<\/a><\/li>/g,pagecountfind:"$1",pagerule:/\/book\/(\d+).html(.*?)<\/div>/g,pagefind:{pid:"$1",content:"$2"},pagedeal:function(a,b){b=b||{};a.forEach(function(a){try{var g=a.id,e=(a.cover||"").replace("https://","http://"),d=a.title,f=a.author_name,l=a.humanize_count,h=a.intro,k=a.updated_time;isNaN(k)||(k=getLocalTime(k));var m=a.last_volume_title;a="更新日期 "+k;if(b.multupdate)return b.multupdate(obj_contact(b,
{pid:g,img:e,title:d,content:a})),!1;if(b.multhot)return b.multhot(obj_contact(b,{pid:g,img:e,title:d,content:a})),!1;if(b.multsearch)return b.multsearch(obj_contact(b,{pid:g,img:e,title:d,content:a})),!1;addcardlist({pid:g,title:d,img:e,content:f?"【作者】"+f+"<br>"+(l?"【字数】"+l+"<br>":"")+(m?"【最新】"+m+"<br>":"")+(k?"【更新】"+k+"<br>":"")+(h?"【简介】"+(100<h.length?cutstr(h,100)+"...":h)+"<br>":""):"",comment:1})}catch(n){}})}}});
