ExView.Plugins({info:{name:"哔咔漫画",version:"2.2",db:"picacomic",icon:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAALaSURBVDhPhZBrSJNhGIb7l0g4LOhP1Ob3bSkmYp4iUTTwkNpSa80000orraXidLSpaUYedjLcLC1GWmDWlknRWvOwmVZgzKLjTGOJaVhmgTlbKXdOP5Nh1AUvPLw8183Ns2IRcgPpyyIImTtJ1pIMRhT1/X8IglhL0IlcaZV4ZnJyEjabDdeamsD2CXvRnCs7X5rKS9pEkuup9eUwGQwZy41AImcP5BIperq7YbVaIRdLYVLcwmWhFJKcIjQKJBZRcmY0pS1B0t1Egb5+2EiQIOmM+efBZCEsJATB/lugvauFvZnqwkVwI3awKW0JT0/PVcWiwh/2JaPBAHFlJXbHJ8CdZP4JtM/bIyLnZrc6SnMkxCvAYJcX6TebwU85Cl5KBqRiCbi7OfOt5o7bQimOlAQdyEv0Dv+8f+ceCPZloTTkIIbKtXh9SYfK/GLwM/MQ4xf67Z/HPBucUc4PykC0dwwEEak4f7wU/KRMxAVyUccVoYMtRl54Si0/m8fj89J5ieyoOEpdQBmWXW7OuQZvNw9wt4VidvANLhRXwtiiQXuXAQ92VaP3phrTY69g/fgMzfVVekpdYP/maH9F8kl1dUE+8jlspKcJEZ92Bk8fm2B5+RymdiPu37mHqZG++QB1fYVjgB06ne6Uk542xi9RolbTicGJ75A3avH2oQ7T799hdtiCn6OvMdXfges1ZcsD7KjKs3Xvx8dhGpnAp+lfuKwx4O3zudqjw3h2RYPhR62wvjNCrSz5e8ANZaGur0eLD1M2PB35ggHLBwyY+vCyWYw2WgG6nATo9CmCemueWeia4EVpS1yvEeq+PmnEKclVKBTNmBkbhVSugrHgLOpdDqBgzQ6UuXIgpyXjrlOOnNKWEGXtrVArhW2nD+0dam1Q6RtkVfojh3P1sUSsvtWZ13vb+cRMDS0F52j7ULg6PpLSlsNisdZRowMBHh5rlC6pSRrnY0omk7nyN67dmMp1K4taAAAAAElFTkSuQmCC",
apihost:"https://picaapi.picacomic.com/",pagetitle:["<br>","收藏","最新更新","类型","下载"],authorization:"",lazyload:!0,theme:"pink",download:!0,setting:!0,settingextra:getui([{name:"authorization",title:"验证信息",type:"input"},{value:'<li><div class="col-50"><a href="#" class="button button-raised open-login-screen">获取验证信息</a></div></li>',type:"html"}]),commentbar:!0,commentbuttons:"",commentplaceholder:"Message",
commentsendbutton:"发送",cdn:""},set:function(a){},unset:function(a){setloginscreen(!1)},init:function(a){a=a||{};plugfns().initloginscreen({plugin:mySession.nowplugin});ExView.workers.fav.listloader({callback:function(){pluginfo(a.plugin).authorization||($$("#card-page").html('<a href="javascript:void(0)" onclick="ExView.fw.loginScreen()"><div align="center" class="list-block"><img src="https://www.picacomic.com/images/apple-icon-180x180.png" onerror="this.src=\'img/nopic.png\';"/><br>悲伤的哔咔哔咔</div></a>'),
$$("#type-page").html('<a href="javascript:void(0)" onclick="ExView.fw.loginScreen()"><div align="center" class="list-block"><img src="https://www.picacomic.com/images/apple-icon-180x180.png" onerror="this.src=\'img/nopic.png\';"/><br>悲伤的哔咔哔咔</div></a>'),slidetopage(1),ExView.fw.alert("请设置登陆账号,否则会无法使用！",sessionStorage.modaltitleextra+"哔咔哔咔",function(){ExView.fw.loginScreen()}))}})},
flags:{indexflag:{loader:function(a){if(pluginfo(a.plugin).authorization)return{url:pluginfo(a.plugin).apihost+"comics?s=ua&page="+parseInt(a.page||1),ua:"okhttp/3.2.0",timeout:120,header:plugfns(a.plugin).headers(a),nativerequest:!0,successfn:function(b,c){a.callback&&a.callback({img:pluginfo(a.plugin).icon,multpage:!0,result:b,header:c})},errorfn:function(){$$("#card-page").html('<div align="center" class="list-block"><img src="img/logo.png" onerror="this.src=\'img/nopic.png\';"/><br><a href="javascript:void(0)" onclick="ExView.workers.index.loader();">重新加载</a>&nbsp;&nbsp;<a href="javascript:void(0)" onclick="ExView.fw.loginScreen()">重新登陆</a></div>');
ExView.fw.alert("网络错误！重新登陆？","ExView")}}},finder:function(a){return{json:!0,str:a.result,successfn:function(b){b=b.data.comics.docs;array_count(b)?plugfns(a.plugin).pagedeal(b,a):a.callback()}}},countloader:!1,countfinder:function(a){return{json:!0,str:a.result,successfn:function(b){a.callback&&a.callback({pagecount:array_count(b)?b.data.comics.pages:"-1"})}}}},typeflag:{loader:function(a){a=a||{};if(pluginfo(a.plugin).authorization)return{url:pluginfo(a.plugin).apihost+
"categories",ua:"okhttp/3.2.0",timeout:120,header:plugfns(a.plugin).headers(a),nativerequest:!0,successfn:function(b,c){a.callback({result:b,header:c})},errorfn:function(){$$("#type-page").html('<div align="center" class="list-block"><img src="img/logo.png" onerror="this.src=\'img/nopic.png\';"/><br><a href="javascript:void(0)" onclick="ExView.workers.type.loader();">重新加载</a>&nbsp;&nbsp;<a href="javascript:void(0)" onclick="ExView.fw.loginScreen()">重新登陆</a></div>');
ExView.fw.alert("网络错误！重新登陆？","ExView")}}},finder:function(a){a=a||{};a.callback({title:"最新更新",img:pluginfo(a.plugin).icon,group:{name:"daohang",title:"导航"},content:"最新更新"});a.callback({tid:"",listflag:"comics/random",title:"随机本子",img:pluginfo(a.plugin).icon,group:{name:"daohang",title:"导航"},content:"随机本子"});return{json:!0,str:a.result,successfn:function(b){b=
((b||{}).data||{}).categories;array_count(b)&&b.forEach(function(b){a.callback({tid:b.title,title:b.title,img:b.thumb.fileServer+"/static/"+b.thumb.path,group:{name:"fenlei",title:"分类"},content:b.title})})}}}},listflag:{loader:function(a){return{url:pluginfo(a.plugin).apihost+(a.flag?a.flag:"comics?page="+parseInt(a.page||1)+"&c="+a.tid+"&s=ua"),method:"GET",ua:"okhttp/3.2.0",timeout:120,header:plugfns(a.plugin).headers(a),nativerequest:!0,successfn:function(b,c){a.callback&&a.callback({multpage:!0,
result:b,header:c})}}},finder:function(a){return{json:!0,str:a.result,successfn:function(b){b=a.flag?b.data.comics:b.data.comics.docs;array_count(b)?plugfns(a.plugin).pagedeal(b,a):a.callback()}}},countloader:!1,countfinder:function(a){return{json:!0,str:a.result,successfn:function(b){a.callback&&a.callback({pagecount:array_count(b)?b.data.comics.pages:"-1"})}}}},searchflag:{loader:function(a){return{url:pluginfo(a.plugin).apihost+"comics/search?page="+parseInt(a.page||1)+"&q="+a.keyword,method:"GET",
ua:"okhttp/3.2.0",timeout:120,header:plugfns(a.plugin).headers(a),nativerequest:!0,successfn:function(b,c){a.callback&&a.callback({multpage:!0,result:b,header:c})}}},finder:function(a){return{json:!0,str:a.result,successfn:function(b,c,f){b=b.data.comics.docs;array_count(b)?plugfns(a.plugin).pagedeal(b,a):a.multsearch?a.multsearch():a.callback()}}},countloader:!1,countfinder:function(a){return{json:!0,str:a.result,successfn:function(b){a.callback&&a.callback({pagecount:array_count(b)?b.data.comics.pages:
"-1"})}}}},contentflag:{loader:function(a){return{url:pluginfo(a.plugin).apihost+"comics/"+a.pid+"/eps?page=1",method:"GET",ua:"okhttp/3.2.0",timeout:120,header:plugfns(a.plugin).headers(a),nativerequest:!0,successfn:function(b,c){a.callback&&a.callback({result:b,header:c})}}},finder:function(a){return{str:a.result,json:!0,successfn:function(b){var c=b.data.eps.total;b=b.data.eps.docs;if(array_count(b)){b=a.pid;if(a.checkupdate)return{pid:b,cid:c,title:"第"+c+"集"};for(var f=[],e=0;e<c;e++)f[e]=
a.callback({id:e,newest:a.newest&&0==e,pid:b,cid:e+1,title:"第"+(e+1)+"集",count:c,reverse:0});console.log(f);return f}a.checkupdate||a.callback()}}},infoloader:function(a){return{url:pluginfo(a.plugin).apihost+"comics/"+a.pid,method:"GET",ua:"okhttp/3.2.0",timeout:120,header:plugfns(a.plugin).headers(a),nativerequest:!0,successfn:function(b,c){a.callback&&a.callback({result:b,header:c})},showinfo:{text:"正在加载内容页...",title:"内容页",name:getlistname(a.pid),
img:getlistimg(a.pid)}}},infofinder:function(a){return{str:a.result,json:!0,successfn:function(b,c,f,e){b=b.data.comic;c=b.title;var g=b.description,d=b.author;f=b.categories;e=b.tags;var k=b.thumb.fileServer+"/static/"+b.thumb.path,h=b.pagesCount,l=b.updated_at,m=b.commentsCount;b=(d?"【作者】"+d+"<br>":"")+("【状态】"+(b.finished?"完结":"连载")+"<br>")+(f?"【类型】"+f.join(",")+"<br>":"")+(e?"【标签】"+e.join(",")+"<br>":
"")+(l?"【更新】"+l+"<br>":"")+(g?"【简介】"+g+"<br>":"");myContent.imgcount=h||0;a.callback({name:c,img:k,added:a.data,description:"<p>共"+(h||0)+"张图片</p>"+b,comment:m,preview:0,tags:gettag(c)+gettag(f)+gettag(e)});return!0}}}},parseflag:{loader:function(a){return{url:pluginfo(a.plugin).apihost+"comics/"+a.pid+"/order/"+a.cid+"/pages?page=1",method:"GET",ua:"okhttp/3.2.0",timeout:120,header:plugfns(a.plugin).headers(a),nativerequest:!0,successfn:function(b,
c){a.callback&&a.callback({result:b,header:c})}}},finder:function(a){console.log(a);return{json:!0,str:a.result,successfn:function(b,c,f,e){b=(b||{}).data.pages;var g=b.pages,d=[];b.docs.forEach(function(a){a=(a||{}).media||{};a=a.fileServer+"/static/"+a.path;a=getcommonload(a);d.push(a)});var k=function(b){array_count(b)?(console.log(b),a.download?a.callback({source:b,download:a.download,plugin:a.plugin}):a.callback({source:b,type:"image",startindex:a.startindex||0,lazyload:pluginfo(a.plugin).lazyload,
zoom:!0,title:a.title})):a.callback()},h=function(b){ExView.modules.curl({url:pluginfo(a.plugin).apihost+"comics/"+a.pid+"/order/"+a.cid+"/pages?page="+b,method:"GET",ua:"okhttp/3.2.0",timeout:120,header:plugfns(a.plugin).headers(a),nativerequest:!0,progressname:"progress_"+a.plugin+"_"+a.pid+"_"+a.cid,progressfn:function(b,c){if(b||c)$$(".downloadprogress_"+a.plugin+"_"+a.pid+"_"+a.cid+".downloadnowpage").html("正在解析中..."),$$(".progress_"+a.plugin+"_"+a.pid+"_"+a.cid).html(" "+
b+(c?"/"+c:"")+" Bytes")},successfn:function(c,e){if(c){var f=JSON.parse(c||"{}"),f=(f||{}).data.pages;f.docs.forEach(function(a){a=(a||{}).media||{};a=a.fileServer+"/static/"+a.path;a=getcommonload(a);d.push(a)});console.log(d);if(b<g)return h(b+1),!1;!a.download&&ExView.fw.hidePreloader();k(d)}else a.download?chapterpredownload({error:"解析错误！",download:a.download,plugin:a.plugin}):(ExView.fw.hidePreloader(),mySession.isloading=0,ExView.fw.alert("图片信息获取失败！",
"ExView"))},errorfn:function(){chapterpredownload({error:"解析错误！",download:a.download,plugin:a.plugin})},showinfo:a.download?"":2==b?{text:"正在加载图片信息...",title:"图片",name:getlistname(a.pid),img:getlistimg(a.pid)}:""})};1<g?h(2):k(d);return!0}}}},commentflag:{loader:function(a){return{url:pluginfo(a.plugin).apihost+"comics/"+a.pid+"/comments?page="+(a.page||1),method:"GET",ua:"okhttp/3.2.0",timeout:120,header:plugfns(a.plugin).headers(a),
nativerequest:!0,successfn:function(b,c){b?a.callback({result:b,header:c,commentbrowser:!1}):a.callback()}}},finder:function(a){return{json:!0,str:a.result,successfn:function(b,c,f,e){b=(b||{}).data.comments;if(array_count(b)){c=b.pages;var g=b.docs,d;for(d in g)a.callback({page:a.page||1,pagecount:c,comment:{text:g[d].content,name:(g[d]._user||{}).name,avatar:function(){try{return(g[d]._user||{}).avatar.fileServer+"/static/"+(g[d]._user||{}).avatar.path}catch(a){return"img/logo.png"}}(),type:"received",
label:g[d].created_at,day:"",time:"",reverse:1,extra:""}})}}}},send:function(a){return{url:pluginfo(a.plugin).apihost+"comics/"+a.pid+"/comments",method:"POST",data:a.value?JSON.stringify({content:a.value}):"",ua:"okhttp/3.2.0",timeout:120,header:plugfns(a.plugin).headers(a),nativerequest:!0,successfn:function(b,c){b?a.callback&&a.callback({text:a.value,name:"我",avatar:"",type:"sent",label:"",day:"",time:"",reverse:1,extra:""}):(ExView.fw.hidePreloader(),mySession.isloading=0,ExView.fw.alert("评论发送失败！",
"ExView"))},showinfo:{text:"正在发送评论信息...",title:"评论页",name:getlistname(a.pid),img:getlistimg(a.pid)}}}},previewflag:{loader:!1,finder:!1},pageimgflag:{parser:!1},updateflag:{loader:function(a){return{url:pluginfo(a.plugin).apihost+"comics?s=ua&page="+parseInt(a.page||1),ua:"okhttp/3.2.0",timeout:120,header:plugfns(a.plugin).headers(a),nativerequest:!0,successfn:function(b,c){a.callback&&a.callback({result:b,header:c})}}},finder:function(a){return{json:!0,
str:a.result,successfn:function(b){b=b.data.comics.docs;array_count(b)&&plugfns(a.plugin).pagedeal(b,a)}}}},hotflag:{loader:function(a){return{url:pluginfo(a.plugin).apihost+"comics/random",ua:"okhttp/3.2.0",timeout:120,header:plugfns(a.plugin).headers(a),nativerequest:!0,successfn:function(b,c){a.callback&&a.callback({result:b,header:c})}}},finder:function(a){return{json:!0,str:a.result,successfn:function(b){b=b.data.comics;array_count(b)&&plugfns(a.plugin).pagedeal(b,a)}}}}},fns:{headers:function(a){return{"api-key":"C69BAF41DA5ABD1FFEDC6D2FEA56B",
accept:"application/vnd.picacomic.com.v1+json",authorization:pluginfo(a.plugin).authorization,"app-version":"2.0.3.11","app-platform":"android","app-uuid":"2f52e49c-76c1-333e-b214-e9499afe8401","Content-Type":"application/json; charset=UTF-8",Host:"picaapi.picacomic.com"}},login:function(a,b,c){ExView.modules.curl({url:pluginfo(c.plugin).apihost+"auth/sign-in",method:"POST",data:'{"email":"'+a+'","password":"'+b+'"}',ua:"okhttp/3.2.0",timeout:120,header:plugfns(c.plugin).headers(c),nativerequest:!0,
successfn:function(f,e){try{var g=JSON.parse(f).data.token;ExView.fw.hidePreloader();pluginfo(c.plugin,1,"user",a);pluginfo(c.plugin,1,"password",b);pluginfo(c.plugin,1,"authorization",g);ExView.fw.alert("已经成功登陆哔咔哔咔！",sessionStorage.modaltitleextra+"登陆成功",function(){$$(".login-screen.modal-in").css("display","none");ExView.workers.index.loader();ExView.workers.type.loader()})}catch(d){ExView.fw.alert(d,sessionStorage.modaltitleextra+
"登陆失败")}},showinfo:{text:"正在登陆哔咔哔咔...",title:"登陆",img:pluginfo(c.plugin).icon}})},initloginscreen:function(a){a=a||{};setloginscreen('<div class="login-screen-title">哔咔哔咔</div><form><div class="list-block inputs-list"><ul><li class="item-content"><div class="item-inner"><div class="item-title label">邮箱</div><div class="item-input item-input-field"><input type="text" id="login-username" name="username" placeholder="Your MailBox"></div></div></li><li class="item-content"><div class="item-inner"><div class="item-title label">密码</div><div class="item-input item-input-field"><input id="login-password" type="password" name="password" placeholder="Your Password"></div></div></li></ul></div><div class="content-block"><a href="#" id="login-login" class="button button-big">登录</a>\x3c!--href="#" id="login-reg" class="button button-big">注册</a--\x3e<a href="#" id="login-cancle" class="button button-big close-login-screen">取消</a></div><div style="position:absolute;bottom:0;text-align:center;margin:0;padding:0;width:100%"><div class="list-block-label">ExView不提供和传播任何资源，所有资源均来源于互联网！</div></div></form>');
pluginfo(a.plugin).user&&$$("#login-username").val(pluginfo(a.plugin).user);pluginfo(a.plugin).password&&$$("#login-password").val(pluginfo(a.plugin).password);$$("#login-reg").on("click",function(){});$$("#login-login").on("click",function(){$$("#login-username").val()&&$$("#login-password").val()?plugfns(a.plugin).login($$("#login-username").val(),$$("#login-password").val(),a):ExView.fw.alert("用户名和密码不能为空！",sessionStorage.modaltitleextra+"ExView")});
$$("#login-cancle").on("click",function(){})},pagedeal:function(a,b){b=b||{};(a||[]).forEach(function(a){var f=function(a){return'<span style="font-size:10px;"><span class="color-white bg-'+getnowtheme()+'" style="padding:3px;border-radius:3px;margin-right:3px;">'+a+"</span></span>"},e=a._id,g=a.title,d=a.finished,k=a.categories,h=a.author,l=f(a.pagesCount+"P");k.forEach(function(a){l+=f(a)});a=a.thumb.fileServer+"/static/"+a.thumb.path;d="【"+(d?"完结":"连载")+"】By "+h;h=
l;if(b.multupdate)return b.multupdate(obj_contact(b,{pid:e,img:a,title:g,content:d})),!1;if(b.multhot)return b.multhot(obj_contact(b,{pid:e,img:a,title:g,content:d})),!1;if(b.multsearch)return b.multsearch(obj_contact(b,{pid:e,img:a,title:g,content:d})),!1;b.callback&&b.callback({pid:e,title:g,img:a,content:h,stitle:d,comment:1,preview:0,extrabutton:""})})}}});
