ExView.Plugins({info:{name:"\u7f51\u6613\u6f2b\u753b",version:"2.2",db:"wangymh",icon:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAAXpQTFRFAAAAwgwMwgwMwgwMwgwMwgwMwQoKwgsLwgwMwgwMwgwMwgwMww8PwgsLwgwMwgsLwgwMwg0NwgsLwgwMwgwMwgwMwgoKwQkJwQkJwgwMwgwMwgwMwgwMwgwMwgwMwgwMwgsLwQkJxhwc1l1dzjs7yCIi5JKS89DQ7La2229vxRcXxBISyCUlwxAQ2GVl7ba25ZiY7rq689HRzTc3wgoK0END01BQ5pub8cfH339/5pyc4IODxRYWwgwMyy8v5JOT0kpK0kxM6KOj6KKi4ISE23JyxyAgxBUV225u01FR4IWF45CQ7bm58szM7ru799/f009PwQoKxx8f34CA7ry84ouL556e221txBYW1ltb3HNz2Wpq4YiI2Wdn4IKCzDIy1lpa55+f5ZmZ8cbGyi0twxIS9NTUzDQ01Vpa56Cg2mxs887O+OTk9+Dg4YeH12FhzTg4ww8P3HJy01JS4o2N8MXF+ebm6qurxBMTwxERySkp0UdHww4O////P7gisgAAACB0Uk5TAAATX7Ts7LQroe3+/u28/u7+4DXqUf7tvrvCRRwXHwg2lXaRAAAAAWJLR0R9prEQyQAAAAlwSFlzAAALEgAACxIB0t1+/AAAAQNJREFUGNNjYGBkZGJmYVVQZGNnZmJkZADyOTi5uBWUlFV4eDk5gCKMHHzcCgqqauoamlr8fByMDEyc3No6unr6BoZGxibcnEwMzFwmpvpm5haWVtY2CrZczAws3Ap29g6O9k7OLq5uCtwsDKy2Cu4enl7ePr5+/gGBtqwMtrYKQVbBIX6hYeHqDoG2tiCBiMjwqOiomNg4NwWgAKttYLxfgmdiUrJ+CpDPysDCn2qdlp5hGKfubaNoCzSUmVfJKTPLKzsnNy+/oFCAGegwQdX0mKSi4pLSsnIlIWGQ0/ltK7QVAiurlKtrREQhnuMHGqcgJi4hKSXNAPU+0HwWZhlZOXkAx/MuPqaiTdIAAAAWdEVYdENyZWF0aW9uIFRpbWUAMDUvMjIvMTX1XZbiAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDE1LTA1LTI1VDAyOjM1OjE0KzAwOjAwhm1U5wAAACV0RVh0ZGF0ZTptb2RpZnkAMjAxNS0wNS0yNVQwMjozNToxNCswMDowMPcw7FsAAABGdEVYdHNvZnR3YXJlAEltYWdlTWFnaWNrIDYuNy44LTkgMjAxNC0wNS0xMiBRMTYgaHR0cDovL3d3dy5pbWFnZW1hZ2ljay5vcmfchu0AAAAAGHRFWHRUaHVtYjo6RG9jdW1lbnQ6OlBhZ2VzADGn/7svAAAAGHRFWHRUaHVtYjo6SW1hZ2U6OmhlaWdodAAxOTIPAHKFAAAAF3RFWHRUaHVtYjo6SW1hZ2U6OldpZHRoADE5MtOsIQgAAAAZdEVYdFRodW1iOjpNaW1ldHlwZQBpbWFnZS9wbmc/slZOAAAAF3RFWHRUaHVtYjo6TVRpbWUAMTQzMjUyMTMxNLtor5gAAAAPdEVYdFRodW1iOjpTaXplADBCQpSiPuwAAABWdEVYdFRodW1iOjpVUkkAZmlsZTovLy9tbnRsb2cvZmF2aWNvbnMvMjAxNS0wNS0yNS84MDQ1NDA0ODgxZTZhNDUyZTRjNTQ1MGQzMmUyMDNlMi5pY28ucG5nUhtsqQAAAABJRU5ErkJggg==",
apihost:"https://manhua.163.com/",pagetitle:["<br>","\u6536\u85cf","\u6700\u65b0\u66f4\u65b0","\u7c7b\u578b","\u4e0b\u8f7d"],lazyload:!0,theme:"red",bottombar:!0,setting:!0,webpage:{url:"http://h5.manhua.163.com/login/form",title:"\u767b\u9646"},commentbar:!1,nativeres:!0,download:!0,cdn:""},set:function(a){},unset:function(a){},init:function(){ExView.workers.fav.listloader()},flags:{indexflag:{loader:function(a){return{url:pluginfo(a.plugin).apihost+"search/book/update_time/data.json?offset="+20*
(parseInt(a.page||1)-1),method:"GET",timeout:120,ua:"ExView",successfn:function(b,c){a.callback({img:pluginfo(a.plugin).icon,multpage:!0,result:b,header:c})}}},finder:function(a){return{json:!0,str:a.result,successfn:function(b){console.log(JSON.stringify(b));if(array_count(b)){b=b.data.dailyDatums;var c=0,d;for(d in b)for(var e=b[d].datum,f=0;f<e.length;f++){if(20<=c)return!1;plugfns(a.plugin).pagedeal(e[f],a);c++}}else a.callback()}}},countloader:function(a){return!1},countfinder:function(a){return{json:!0,
str:a.result,successfn:function(b){a.callback({pagecount:0})}}}},typeflag:{loader:function(a){return{url:pluginfo(a.plugin).apihost+"category",method:"GET",timeout:120,nativerequest:pluginfo(a.plugin).nativeres,header:{"User-Agent":"ExView"},successfn:function(b,c){a.successfn&&a.successfn({result:b,header:c})}}},finder:function(a){a.callback({title:"\u6700\u65b0\u66f4\u65b0",img:pluginfo(a.plugin).icon,group:{name:"daohang",title:"\u5bfc\u822a"},content:"\u6700\u65b0\u66f4\u65b0"});a.callback({tid:"",
listflag:"sort=2",title:"\u6392\u884c\u699c",img:pluginfo(a.plugin).icon,group:{name:"daohang",title:"\u5bfc\u822a"},content:"\u6392\u884c\u699c"});a.callback({tid:"",listflag:"sort=4",title:"\u65b0\u4f5c\u4e0a\u67b6",img:pluginfo(a.plugin).icon,group:{name:"daohang",title:"\u5bfc\u822a"},content:"\u65b0\u4f5c\u4e0a\u67b6"});return{query:!0,selector:".fform-toselect-row",str:a.result,successfn:function(b,c,d){c=$$(b).find(".fl-ftitle").text();var e="group"+d,f=$$(b).find(".fform-toselect-item-wrapper[data-value]");
for(d=0;d<f.length;d++)a.callback({tid:getstr(/js-(\w+)$/,$$(b).find(".fform-toselect-ct")[0].className)+"="+$$(f[d]).attr("data-value"),title:$$(f[d]).find(".fform-toselect-item").text(),img:pluginfo(a.plugin).icon,group:{name:e,title:c},content:$$(f[d]).find(".fform-toselect-item").text()})}}}},listflag:{loader:function(a){return{url:pluginfo(a.plugin).apihost+"category/getData.json?"+(a.flag?a.flag+"&":a.tid+"&")+"pageSize=20&page="+(a.page||1),method:"GET",timeout:120,ua:"ExView",successfn:function(b,
c){a.callback({multpage:!0,result:b,header:c})}}},finder:function(a){return{json:!0,str:a.result,successfn:function(b){b=b.books;array_count(b)?b.forEach(function(b){plugfns(a.plugin).pagedeal(b)}):a.callback()}}},countloader:function(a){return!1},countfinder:function(a){return{json:!0,str:a.result,successfn:function(b){try{var c=parseInt(b.pageQuery.pageCount)}catch(d){c=-1}a.callback({pagecount:c})}}}},searchflag:{loader:function(a){return{url:pluginfo(a.plugin).apihost+"search/book/key.do?key="+
a.keyword+"&page="+(parseInt(a.page||1)-1),method:"GET",timeout:120,ua:"ExView",successfn:function(b,c){a.callback({multpage:!0,result:b,header:c})}}},finder:function(a){return{reg:/<div class="item-wrap f-fl" >((?:.|[\r\n])*?)<\/div>\s*\r*\n*\s*<\/div>\s*\r*\n*\s*<\/div>\s*\r*\n*\s*<div/g,str:a.result,find:"$1",successfn:function(b,c,d){if(b){b=b.split("{{separator}}");c=getstr(/\/source\/(\d+)"\s*target="_blank"(?!<).*?>((?!<).*?)<\/a>/,b[0],1);d=getstr(/\/source\/(\d+)"\s*target="_blank"(?!<).*?>((?!<).*?)<\/a>/,
b[0],2);var e=getstr(/<span>\u6700\u65b0\u8bdd\uff1a((?!<).*?)<\/span>/,b[0]),f=getstr(/<span>\u53d1\u3000\u5e03\uff1a<\/span><span>((?!<).*?)<\/span>/,b[0]),g=getstr(/"work-desc">((?:.|[\r\n])*?)<\/div>/,b[0]);b=getstr(/<img(?!<).*?src="((?!\").*?)"/,b[0]);if(a.multsearch)return a.callback(obj_contact(a,{pid:c,img:b,title:d,content:"\u66f4\u65b0\u81f3"+e})),!1;a.callback({pid:c,title:d,name:d,img:b,content:g,stitle:"\u3010\u66f4\u65b0\u81f3"+e+"\u3011"+f,comment:1})}else a.multsearch?a.callback():
a.callback('<div align="center" class="list-block"><img src="img/logo.png"/><br>\u6ca1\u6709\u5185\u5bb9</div>',1)}}},countloader:function(a){return!1},countfinder:function(a){return{reg:/\u641c\u7d22\u7ed3\u679c\(((?!<).*?)\)<\/h1>/g,str:a.result,find:"$1",successfn:function(b){try{var c=Math.ceil(b[0]/60)||0}catch(d){c=-1}a.callback({pagecount:c})}}}},contentflag:{loader:function(a){return{url:pluginfo(a.plugin).apihost+"book/catalog/"+a.pid,method:"GET",timeout:120,ua:"ExView",successfn:function(b,
c){a.callback({result:b,header:c})}}},finder:function(a){return{json:!0,str:a.result,successfn:function(b,c,d,e){if(array_count(b)){b=b.catalog.sections[0].sections;if(a.checkupdate)return c=b[b.length-1],{pid:c.bookId,cid:c.sectionId,title:c.title};e=[];d=0;b.forEach(function(c){e[d]=additemlist({id:d,newest:a.newest&&0==d,pid:c.bookId,cid:c.sectionId,title:(c.needPay?"\u3010VIP\u3011":"")+c.title+"("+c.wordCount+"P)",count:b.length,reverse:0});d++});return e}a.checkupdate||(ExView.fw.hidePreloader(),
mySession.isloading=0,ExView.fw.alert("\u5185\u5bb9\u9875\u83b7\u53d6\u5931\u8d25\uff01","ExView"))}}},infoloader:function(a){return{url:pluginfo(a.plugin).apihost+"source/"+a.pid,method:"GET",timeout:120,ua:"ExView",successfn:function(b,c){a.callback({result:b,header:c})}}},infofinder:function(a){console.log(a);return{reg:/<div\s*class="container">((?:.|[\r\n])*?)<div\s*class="action-area">/g,str:a.result,find:"$1",successfn:function(b,c,d,e){b=b.split("{{separator}}");c=getstr(/\s*class="f-ib(?!<).*?>((?!<).*?)<\//,
b[0]);d=getstr(/"metadata">\u72b6\u6001\uff1a(?!<).*?>((?!<).*?)<\/a>/,b[0]);e=getstr(/<img(?!<).*?src="((?!\").*?)"/,b[0]);var f=getstr(/detail,publisher,\d+"(?!<).*?>((?!<).*?)<\/a>/,b[0]),g=getstr(/class="desc-inner(?!\").*?">((?:.|[\r\n])*?)</,b[0]);b=gettags(b[0],/detail,subject,\d+">((?!<).*?)<\/a>/g,"$1");a.callback({name:c,img:e,added:a.data,description:"<p>\u3010\u4f5c\u8005\u3011"+f+"<br>\u3010\u72b6\u6001\u3011"+d+"<br>\u3010\u7b80\u4ecb\u3011"+g+"</p>",comment:1,preview:0,tags:gettag(c)+
b+gettag(f)+gettag(d),sourceurl:pluginfo(a.plugin).apihost+"source/"+a.pid+"/"});return!0}}}},parseflag:{loader:function(a){return{url:pluginfo(a.plugin).apihost+"reader/section/"+a.pid+"/"+a.cid,method:"GET",timeout:120,successfn:function(b,c){try{if(JSON.parse(b).canBuy)return a.download?chapterpredownload({error:"VIP\u4f60\u5c31\u522b\u60f3\u5566\uff01",download:a.download,plugin:a.plugin}):(ExView.fw.hidePreloader(),mySession.isloading=0,ExView.fw.alert("VIP\u4f60\u5c31\u522b\u60f3\u5566\uff01",
"ExView")),!1}catch(d){}a.callback({result:b,header:c})}}},finder:function(a){console.log(a);return{json:!0,str:a.result,successfn:function(b,c,d,e){b=b.images;array_count(b)?(b=b.map(function(a){return(a.url||"").replace("https://","http://")}),console.log(b),a.download?a.callback({source:b,download:a.download,plugin:a.plugin}):a.callback({source:b,type:"image",startindex:a.startindex||0,lazyload:pluginfo(a.plugin).lazyload,zoom:!0,title:a.title})):a.callback();return!0}}}},commentflag:{loader:function(a){return{url:pluginfo(a.plugin).apihost+
"comment/"+a.pid+"/comments?total=true&limit=20&page="+(a.page||1)+"&pageSize=20",method:"GET",timeout:120,ua:"ExView",successfn:function(b,c){b?a.callback&&a.callback({result:b,header:c,commentbrowser:{url:pluginfo(a.plugin).apihost+"source/"+a.pid+"/",title:"\u8bc4\u8bba - "+pluginfo(a.plugin).name+'<br><span style="font-size:16px">'+(myContent.name||"")+"</span>",browser:!1,flag:""}}):a.callback()}}},finder:function(a){console.log(a);return{json:!0,str:a.result,successfn:function(b,c,d,e){c=(b||
{}).comments;var f=(b||{}).pageCount;array_count(c)&&c.forEach(function(b){a.callback&&a.callback({page:a.page||1,pagecount:f,comment:{text:b.content,name:b.userNickName,avatar:b.userAvatar,type:"received",label:(new Date(parseInt(b.createTime))).toLocaleString().replace(/:\d{1,2}$/," "),day:"",time:"",reverse:1}})})}}},send:!1},previewflag:{loader:!1,finder:!1,more:!1},pageimgflag:{parser:!1},updateflag:{loader:function(a){return{url:pluginfo(a.plugin).apihost+"search/book/update_time/data.json?offset="+
20*(parseInt(a.page||1)-1),method:"GET",timeout:120,ua:"ExView",successfn:function(b,c){a.callback({result:b,header:c})}}},finder:function(a){return{json:!0,str:a.result,successfn:function(b){console.log(JSON.stringify(b));if(array_count(b)){b=b.data.dailyDatums;var c=0,d;for(d in b)for(var e=b[d].datum,f=0;f<e.length;f++){if(20<=c)return!1;plugfns(a.plugin).pagedeal(e[f],a);c++}}}}}},hotflag:{loader:function(a){return{url:pluginfo(a.plugin).apihost+"category/getData.json?sort=2&pageSize=20&page="+
(a.page||1),method:"GET",timeout:120,ua:"ExView",successfn:function(b,c){a.callback({result:b,header:c})}}},finder:function(a){return{json:!0,str:a.result,successfn:function(b){b=b.books;array_count(b)?b.forEach(function(b){plugfns(a.plugin).pagedeal(b,a)}):a.callback()}}}}},fns:{pagedeal:function(a,b){b=b||{};var c=a.bookId,d=a.title,e=a.cover.replace("https://","http://"),f=a.author,g="\u66f4\u65b0\u81f3"+a.latestSectionOrderDecorate,h=a.shortIntro,l=a.stringLatestPublishTime||a.latestPublishTimeStr,
m=a.description,n=a.payType,k=h+" - \u66f4\u65b0\u81f3"+a.latestSectionTitle,f=a.author;if(b.multupdate)return b.multupdate(obj_contact(b,{pid:c,img:e,title:d,content:k})),!1;if(b.multhot)return b.multhot(obj_contact(b,{pid:c,img:e,title:d,content:k})),!1;addcardlist({pid:c,title:d,name:d+" - "+h,img:e,stitle:g+" "+l,content:(f?getboxitem(f):"")+(n?getboxitem("VIP"):"")+m,comment:1})}}});
