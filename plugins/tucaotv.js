ExView.Plugins({info:{name:"吐槽视频",version:"2.2",author:"Gentle",icon:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAIAAACQkWg2AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAALhSURBVDhPPZHbUxIBGMX3X+wtZ3rqoYemGtMBlUUJUYYoL5ji4qoQZYEgauqK5S0d8AINyBI3g1ZYWHYXl5tuGLv7RT30mzPfzDkv38w5yERSNqfBGJeNpGSISR0brshcrVm8zNYrgqQosixDB0X5dwEZjsmjWRhOgu47dEchdvM356o8GTz9jvv4ZPav/88dICOkpE+C9kJGo9I+B1VRLKdz9Haw7DuMaGcy2AoTzzQajVILqi2ANiDHrITGYehCJhvQuKKu7Jvcaw/M+MHqh/ldaXb71krQTn8mHIuLQNUV5FdbfpEEfxnEApXTYNQzy7XpI7w/urP5f+M7om07b1r6PbV18dhUCoQPBEB8Bdl8Cexdm5rz8t1WGsUrQ46Majqpnk71TrVG3akeC9k7wfbhlMnJCHXEmAJHCSqVCqXDGRUmmN3coL2gtiX6JxmzUxr2FE329Ii1ib7LTbiqx98Qc0bxXQObSDHofM3w4YcGI57qx+49tKk1pB6jXzr3Mev4k+e+x2gG87RoFik3Fb4NVCAs6N4qsztXQ9hc30DogY6OxoqXcVEsnUzOk5YPfscSPTAnsDzSqbYDdRIVDEuA71XNrjix/mPli8gxAHWAWjlwUjo8r0RjNY2DDUQR6LQLUAiRNaOrOPKubdvlnQQVCUOLF+LR3CpRy2ckqF5HI7fDrp/OLaQlKp1x8wfn8hui0IdRmrl8P35umPq07k0tLDenPcx74qdnK9g7lsC8XDqLRKoKU7vh7YQ8uSEM2q/RBbbb2tz/qtWPOh6pyBls26hb17zI9WMCz4VuAdngocawxVcfBXSx0pF2ke/BSiv+JBkc0D5TDXb1oF1en0Owbdx8Dp0KbcR5pTQkJRs4S2uxugoX+vHbgQXDffXi22Vicw8bG7eMTa1Zljqfb3bOIvU2EhBA4NlMMFQIfKOPwvnjMH0aCeyfrK7tepYJt2vL5SaO/MdcJMHXm+4i/AFXwVFzBLfmrwAAAABJRU5ErkJggg==",
db:"tucaotv",type:"video",apihost:"http://www.tucao.tv/",pagetitle:["<br>","收藏","连载新番","类型","下载"],download:!1,lazyload:!0,setting:!0,theme:"red",cdn:""},set:function(a){},unset:function(a){},init:function(a){ExView.workers.fav.listloader({callback:function(){}})},flags:{indexflag:{loader:function(a){return{url:pluginfo(a.plugin).apihost+"list/11/index_"+(a.page||1)+".html",method:"GET",timeout:120,cookie:"tucao_verify=ok",successfn:function(b,c){a.callback({img:pluginfo(a.plugin).icon,
multpage:!0,result:b,header:c})}}},finder:function(a){return{query:!0,selector:".lists_box .box",str:a.result,successfn:function(b){array_count(b)?plugfns(a.plugin).pagedeal(b,a):a.callback()}}},countloader:!1,countfinder:function(a){return{query:!0,selector:".selectpages option:nth-last-child(1)",str:a.result,successfn:function(b){try{var c=$$(b).text(),d=parseInt(c)}catch(f){d=-1}a.callback({pagecount:d})}}}},typeflag:{loader:function(a){return{url:pluginfo(a.plugin).apihost,method:"GET",timeout:120,
cookie:"tucao_verify=ok",successfn:function(b,c){a.callback({result:b,header:c})}}},finder:function(a){a.callback({title:"连载新番",img:pluginfo(a.plugin).icon,group:{name:"S"+ExView.tools.md5.hex_md5("新番"),title:"新番"},content:"连载新番"});ExView.modules.curl({url:pluginfo(a.plugin).apihost+"list/24/",method:"GET",timeout:120,cookie:"tucao_verify=ok",successfn:function(b,c){for(var d="星期天 星期一 星期二 星期三 星期四 星期五 星期六 天朝出品".split(" "),
f=getquery(b,".xf_list ul"),e=0;e<f.length;e++){var g=d[e];$$(f[e]).find("li").each(function(){var b=$$(this).find("em").text(),c=$$(this).find("img").attr("src"),d=$$(this).find("a").attr("href").substring(0);a.callback({tid:"search",listflag:d,title:b,img:c,group:{name:"S"+ExView.tools.md5.hex_md5(g),title:g},content:b})})}console.log(f)},showinfo:""});return{query:!0,selector:".header_nav",str:a.result,successfn:function(b){if(array_count(b)){b=$$(b).find(".nav_link");for(var c=0;c<b.length;c++)if(0!=
c)for(var d=b.eq(c).text(),f="S"+ExView.tools.md5.hex_md5(d),e=getquery(a.result,"#nav_"+c).find("a"),g=0;g<e.length;g++){var k=getstr(/\/list\/(\d+)\//,$$(e[g]).attr("href")),h=$$(e[g]).text();"连载新番"!=h&&a.callback({tid:k,title:h,img:pluginfo(a.plugin).icon,group:{name:f,title:d},content:h})}}}}}},listflag:{loader:function(a){return{url:pluginfo(a.plugin).apihost+("search"==a.tid?a.flag+"&page="+(a.page||1):"list/"+a.tid+"/index_"+(a.page||1)+".html"),method:"GET",timeout:120,
cookie:"tucao_verify=ok",successfn:function(b,c){a.callback({multpage:!0,result:b,header:c})}}},finder:function(a){return{query:!0,selector:"search"==a.tid?".search_list .list":".lists_box .box",str:a.result,successfn:function(b){array_count(b)?plugfns(a.plugin).pagedeal(b,a):a.callback()}}},countloader:!1,countfinder:function(a){return{query:!0,selector:"search"==a.tid?".pages a:nth-last-child(2)":".selectpages option:nth-last-child(1)",str:a.result,successfn:function(b){try{var c=$$(b).text()||
-1,d=parseInt(c)}catch(f){d=-1}a.callback({pagecount:d})}}}},searchflag:{loader:function(a){return{url:pluginfo(a.plugin).apihost+"index.php?m=search&c=index&a=init2&q="+a.keyword+"&page="+(a.page||1),method:"GET",timeout:120,cookie:"tucao_verify=ok",successfn:function(b,c){a.callback({multpage:!0,result:b,header:c})}}},finder:function(a){return{query:!0,selector:".search_list .list",str:a.result,successfn:function(b){array_count(b)?plugfns(a.plugin).pagedeal(b,a):a.callback()}}},countloader:!1,countfinder:function(a){return{query:!0,
selector:".pages a:nth-last-child(2)",str:a.result,successfn:function(b){try{var c=$$(b).text()||-1,d=parseInt(c)}catch(f){d=-1}a.callback({pagecount:d})}}}},contentflag:{loader:function(a){return{url:pluginfo(a.plugin).apihost+"play/h"+a.pid+"/",method:"GET",timeout:120,cookie:"tucao_verify=ok",successfn:function(b,c){a.callback({result:b,header:c})}}},finder:function(a){return{query:!0,selector:"#player_code  li:nth-child(1)",str:a.result,successfn:function(b,c,d,f){b=$$(b).text();b=b.split("**");
if(array_count(b)){if(a.checkupdate)return c=b.pop().split("|"),a.callback({pid:a.pid,cid:c[0],title:"第 "+(c[1]||b.length+1)+" 集"}),!0;f=[];b.forEach(function(c,d){var k=c.split("|"),h=k[1]||d+1;f[d]=a.callback({id:d,newest:a.newest&&0==d,pid:a.pid,cid:k[0],title:isNaN(h)?h:"第 "+h+" 集",count:b.length,reverse:0})});return f}a.callback()}}},infoloader:!1,infofinder:function(a){return{query:!0,selector:".tab_mod",str:a.result,successfn:function(b,c,d,f){b=$$(b);c=getlistimg(a.pid,
a.plugin);d=getlistname(a.pid,a.plugin);f=getquery(a.result,".show_time").text();for(var e=getquery(a.result,".r_user").text(),g=b.find(".show_key a"),k=[],h=0;h<g.length;h++)k.push($$(g[h]).text());b=b.find(".show_content").html();a.callback({name:d,img:c,added:a.data,description:"<p>"+(e?"【作者】"+e+"<br>":"")+(k?"【类型】"+k.join(",")+"<br>":"")+(f?"【更新】"+f+"<br>":"")+(b?"【简介】"+b:"")+"</p>",comment:1,preview:0,tags:gettag(d)+
gettag(e)+gettag(k||""),sourceurl:pluginfo(a.plugin).apihost+"play/h"+a.pid+"/"});return!0}}}},parseflag:{loader:function(a){return{url:"http://api.tucao.tv/api/playurl?"+a.cid,method:"GET",timeout:120,successfn:function(b,c){a.callback({result:b,header:c})}}},finder:function(a){return{query:!0,selector:"url",str:a.result,successfn:function(b,c,d,f){if(array_count(b)){var e=[];for(d=0;d<c.length;d++)e.push($$(c[d]).html().replace("\x3c!--[CDATA[","").replace("]]--\x3e",""));var g=$$(".listcover img").attr("src");
ExView.fw.hidePreloader();var k=/\/flv\/|\.flv/.test(e[0]),k=k?"flv":"mp4",h=function(b){a.callback({poster:g,url:pluginfo(a.plugin).apihost+"play/h"+a.pid+"/",source:e,type:"video",videoType:k,title:myContent.name+getnavundertitle(a.title),danmaku:{id:"Tucao_"+a.pid,api:"https://api.prprpr.me/dplayer/",token:"tokendemo",maximum:1E3,addition:b?[b]:[],user:"ExView"}})};ExView.modules.curl({url:pluginfo(a.plugin).apihost+"index.php?m=mukio&c=index&a=init&playerID=28-"+a.pid+"-1-0&r=797",successfn:function(a){var b=
[];a=getquery(a,"d");$$(a).each(function(){var a=$$(this).attr("p"),c=$$(this).text(),a=a.split(",")[0];b.push({author:"",time:a,text:c,color:"#ffffff",type:"right"})});b={code:1,danmaku:b};console.log(b);a=new Blob([JSON.stringify(b)],{type:"text/plain; charset=utf-8"});var c=URL.createObjectURL(a);setTimeout(function(){URL.revokeObjectURL(c)},1E3);h(c);console.log(c)},errorfn:function(a){h()},showinfo:{text:"正在获取弹幕信息...",title:"视频",name:getlistname(a.pid),
img:getlistimg(a.pid)}})}else a.callback();return!0}}}},commentflag:{loader:function(a){return myContent.cmkey?{url:pluginfo(a.plugin).apihost+"index.php?m=comment&c=index&a=init&commentid=content_"+myContent.cmkey+"&hot=0&iframe=1&page="+(a.page||1),method:"GET",timeout:120,successfn:function(b,c){b?a.callback({result:b,header:c,commentbrowser:{url:pluginfo(a.plugin).apihost+"index.php?m=comment&c=index&a=init&commentid=content_"+myContent.cmkey+"&hot=0&iframe=1",title:"评论 - "+pluginfo(a.plugin).name+
'<br><span style="font-size:16px">'+(myContent.name||"")+"</span>",browser:!1,flag:""}}):a.callback()}}:{url:pluginfo(a.plugin).apihost+"play/h"+a.pid+"/",method:"GET",timeout:120,successfn:function(b,c){myContent.cmkey=getquery(b,"#player_code li:nth-last-child(1)").text();ExView.modules.curl({url:pluginfo(a.plugin).apihost+"index.php?m=comment&c=index&a=init&commentid=content_"+myContent.cmkey+"&hot=0&iframe=1&page="+(a.page||1),method:"GET",timeout:120,successfn:function(b,c){b?a.callback({result:b,
header:c,commentbrowser:{url:pluginfo(a.plugin).apihost+"index.php?m=comment&c=index&a=init&commentid=content_"+myContent.cmkey+"&hot=0&iframe=1",title:"评论 - "+pluginfo(a.plugin).name+'<br><span style="font-size:16px">'+(myContent.name||"")+"</span>",browser:!1,flag:""}}):a.callback()},showinfo:{text:"正在获取评论信息...",title:"评论页",name:getlistname(a.pid),img:getlistimg(a.pid)}})}}},finder:function(a){return{query:!0,selector:".comment_list",
str:a.result,successfn:function(b,c,d,f){b=$$(b).find("tr");c=[];for(d=0;d<b.length;d++)b.eq(d).find(".user").length?c.push({user:b.eq(d).find(".user").text(),img:b.eq(d).find("img").attr("src"),content:b.eq(d).find(".info.c").text()}):(c[c.length-1].floot=b.eq(d).find(".lch").text(),c[c.length-1].time=b.eq(d).find(".time").text());if(array_count(c))for(var e in c)a.callback({page:a.page||1,pagecount:0,comment:{text:c[e].content,name:c[e].user,avatar:c[e].img,type:"received",label:c[e].floot,day:c[e].time,
time:"",reverse:1,extra:""}})}}},send:!1},previewflag:{loader:!1,finder:!1},pageimgflag:{parser:!1},updateflag:{loader:function(a){return{url:pluginfo(a.plugin).apihost+"list/11/index_"+(a.page||1)+".html",method:"GET",timeout:120,cookie:"tucao_verify=ok",successfn:function(b,c){a.callback({result:b,header:c})}}},finder:function(a){return{query:!0,selector:".lists_box .box",str:a.result,successfn:function(b){array_count(b)?plugfns(a.plugin).pagedeal(b,a):a.callback()}}}},hotflag:{loader:function(a){return{url:pluginfo(a.plugin).apihost+
"list/26/index_"+(a.page||1)+".html",method:"GET",timeout:120,cookie:"tucao_verify=ok",successfn:function(b,c){a.callback({result:b,header:c})}}},finder:function(a){return{query:!0,selector:".lists_box .box",str:a.result,successfn:function(b){array_count(b)?plugfns(a.plugin).pagedeal(b,a):a.callback()}}}}},fns:{pagedeal:function(a,b){b=b||{};console.log(a);a=$$(a);var c=getstr(/\/h(\d+)\//,a.find(".pic").attr("href"))||getstr(/\/h(\d+)\//,a.find(".pic a").attr("href")),d=a.find("img").attr("src"),
f=a.find("img").attr("alt"),e=(a.find(".user").text()||"").replace("UP:"," ")||(a.find(".c").text()||"").replace("投稿:","").replace("发布于："," "),g=a.find(".description").text()||a.find(".d").text();if(b.multupdate||b.multhot||b.multsearch)return b.callback(obj_contact(b,{pid:c,img:d,title:f,content:e})),!1;b.callback({pid:c,title:f,img:d,stitle:e,content:g,comment:1})}}});
