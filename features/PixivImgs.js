ExView.Plugins({info:{name:"Pixiv图片流",version:"2.3",icon:getbaiduimg("574621f790529822462bc715d0ca7bcb0b46d4b5"),db:"PixivImgs",type:"feature",fn:"ExView.modules.pixivimgs.init();"},set:function(){ExView.modules.pixivimgs={init:function(a){myContent={previewloading:0};ExView.modules.pixivimgs.load({page:1})},load:function(a){ExView.fw.showPreloader(sessionStorage.modaltitleextra+'<span style="word-wrap:break-word;">Pixiv图片流<br>正在加载...</span>');$$.ajax({url:(window.debug?
window.debugcdn:"")+"http://touch.pixiv.net/ajax_api/ajax_api.php?mode=popular_illust&type=&p="+(a.page||1),success:function(b){try{b=r=JSON.parse(b),b=b.map(function(a){var b=a.url,b=getcommonload((window.debug?window.debugcdn:"")+b,{cacheheader:{Referer:"http://www.pixiv.net/"}});if(a.url&&a.illust_id)return a=(window.debug?window.debugcdn:"")+"https://www.pixiv.net/member_illust.php?mode=medium&illust_id="+a.illust_id+"&test=n_list",a=getpageload(a,"pixiv",{cacheheader:{Referer:"http://www.pixiv.net/",
"User-Agent":"ExView"},nativeres:!0,successfn:function(a,b,e){$$.ajax({url:a,success:function(a){a="<div>"+a.replace(/\ssrc=\"/g,' exview-src="').replace(/\ssrc=\'/g," exview-src='").replace(/\shref=\"/g,' exview-href="').replace(/\shref=\'/g," exview-href='")+"</div>";console.log($$(a));var c=$$(a).find("a[data-title='registerImage'] img");console.log(c);c.length||(c=$$(a).find(".multiple img"));var d=c.attr("exview-src"),c=c.attr("alt");a=getstr(/\/illusts\/(\d+)/,a);d&&(d=getcommonload(d,{cacheheader:{Referer:"http://www.pixiv.net/"},
nativeres:!0})+(e?"&reload=1":""));console.log("Fuck"+d);$$(b).attr("src",d||"img/nopic.png");c&&$$(".page[data-page='previewcontent']").find(".navbar-inner").find(".center").html(c+getnavundertitle(a||""))},error:function(){$$(b).attr("src","img/nopic.png")}})}}),{imgurl:b,pageurl:a}}),array_remove(b,void 0),ExView.fw.hidePreloader(),myContent.preview={},myContent.preview[a.page||1]=b,a.more?a.more(a.page||1):(myContent.previewloading=0,myContent.count=a.page||1,ExView.modules.previewpage.init(a,
function(){myContent.previewloading||(myContent.previewloading=1,myContent.count++,ExView.modules.pixivimgs.load(obj_contact(a,{page:myContent.count,more:function(a){myContent.previewloading=0;ExView.modules.previewpage.add(a,1);$$(".previewpage-content").css("zoom",parseFloat($$("#previewpage").attr("zoom")))}})))},1,"","Pixiv图片流",function(){$$("#previewpage").parents(".dynamic-page").find(".dynamic-page-close").trigger("click");setTimeout(function(){$$("#previewpage").parents(".dynamic-page").remove();
ExView.modules.pixivimgs.init()},600)}))}catch(e){myContent.previewloading=1,ExView.fw.hidePreloader(),$$(".previewerrorinfo").remove(),$$("#previewpage").append('<div class="previewerrorinfo" style="width:100%;text-align:center;"><a class="button button-fill navbutton bg-red" href="javascript:void(0);" onclick="$$(\'.previewerrorinfo\').remove();ExView.modules.pixivimgs.load({page:'+a.page+'});">重试加载第'+a.page+"页</a></div>"),ExView.fw.alert("解析错误！",
sessionStorage.modaltitleextra+"Pixiv图片流")}},error:function(){myContent.previewloading=1;$$(".previewerrorinfo").remove();$$("#previewpage").append('<div class="previewerrorinfo" style="width:100%;text-align:center;"><a class="button button-fill navbutton bg-red" href="javascript:void(0);" onclick="$$(\'.previewerrorinfo\').remove();ExView.modules.pixivimgs.load({page:'+a.page+'});">重试加载第'+a.page+"页</a></div>");ExView.fw.hidePreloader();ExView.fw.alert("网络错误！",
sessionStorage.modaltitleextra+"Pixiv图片流")}})}}}});
